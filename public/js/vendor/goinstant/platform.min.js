!function(){var requirejs,require,define;if(function(t){function e(t,e){return y.call(t,e)}function n(t,e){var n,r,o,i,s,a,u,c,l,f,p=e&&e.split("/"),h=m.map,d=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),c=0;c<t.length;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&h){for(n=t.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if(o=h[p.slice(0,l).join("/")],o&&(o=o[r])){i=o,s=c;break}if(i)break;!a&&d&&d[r]&&(a=d[r],u=c)}!i&&a&&(i=a,s=u),i&&(n.splice(0,s,i),t=n.join("/"))}return t}function r(e,n){return function(){return l.apply(t,v.call(arguments,0).concat([e,n]))}}function o(t){return function(e){return n(e,t)}}function i(t){return function(e){h[t]=e}}function s(n){if(e(d,n)){var r=d[n];delete d[n],g[n]=!0,c.apply(t,r)}if(!e(h,n)&&!e(g,n))throw new Error("No "+n);return h[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return m&&m.config&&m.config[t]||{}}}var c,l,f,p,h={},d={},m={},g={},y=Object.prototype.hasOwnProperty,v=[].slice;f=function(t,e){var r,i=a(t),u=i[0];return t=i[1],u&&(u=n(u,e),r=s(u)),u?t=r&&r.normalize?r.normalize(t,o(e)):n(t,e):(t=n(t,e),i=a(t),u=i[0],t=i[1],u&&(r=s(u))),{f:u?u+"!"+t:t,n:t,pr:u,p:r}},p={require:function(t){return r(t)},exports:function(t){var e=h[t];return"undefined"!=typeof e?e:h[t]={}},module:function(t){return{id:t,uri:"",exports:h[t],config:u(t)}}},c=function(n,o,a,u){var c,l,m,y,v,b,_=[];if(u=u||n,"function"==typeof a){for(o=!o.length&&a.length?["require","exports","module"]:o,v=0;v<o.length;v+=1)if(y=f(o[v],u),l=y.f,"require"===l)_[v]=p.require(n);else if("exports"===l)_[v]=p.exports(n),b=!0;else if("module"===l)c=_[v]=p.module(n);else if(e(h,l)||e(d,l)||e(g,l))_[v]=s(l);else{if(!y.p)throw new Error(n+" missing "+l);y.p.load(y.n,r(u,!0),i(l),{}),_[v]=h[l]}m=a.apply(h[n],_),n&&(c&&c.exports!==t&&c.exports!==h[n]?h[n]=c.exports:m===t&&b||(h[n]=m))}else n&&(h[n]=a)},requirejs=require=l=function(e,n,r,o,i){return"string"==typeof e?p[e]?p[e](n):s(f(e,n).f):(e.splice||(m=e,n.splice?(e=n,n=r,r=null):e=t),n=n||function(){},"function"==typeof r&&(r=o,o=i),o?c(t,e,n,r):setTimeout(function(){c(t,e,n,r)},4),l)},l.config=function(t){return m=t,m.deps&&l(m.deps,m.callback),l},define=function(t,n,r){n.splice||(r=n,n=[]),e(h,t)||e(d,t)||(d[t]=[t,n,r])},define.amd={jQuery:!0}}(),define("../node_modules/almond/almond",function(){}),function(t){function e(t,e,n){for(var r=(n||0)-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}function n(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n];"number"!=r&&"string"!=r&&(r="object");var o="number"==r?n:w+n;return t=t[r]||(t[r]={}),"object"==r?t[o]&&e(t[o],n)>-1?0:-1:t[o]?0:-1}function r(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:w+t,o=e[n]||(e[n]={});"object"==n?(o[r]||(o[r]=[])).push(t)==this.array.length&&(e[n]=!1):o[r]=!0}}function o(t){return t.charCodeAt(0)}function i(t,e){var n=t.index,r=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||"undefined"==typeof t)return 1;if(e>t||"undefined"==typeof e)return-1}return r>n?-1:1}function s(t){var e=-1,n=t.length,o=c();o["false"]=o["null"]=o["true"]=o.undefined=!1;var i=c();for(i.array=t,i.cache=o,i.push=r;++e<n;)i.push(t[e]);return o.object===!1?(h(i),null):i}function a(t){return"\\"+Z[t]}function u(){return y.pop()||[]}function c(){return v.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,undefined:!1,useHas:!1,useKeys:!1,value:null}}function l(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function f(){}function p(t){t.length=0,y.length<S&&y.push(t)}function h(t){var e=t.cache;e&&h(e),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,v.length<S&&v.push(t)}function d(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}function m(r){function y(t){return t&&"object"==typeof t&&!Gr(t)&&gr.call(t,"__wrapped__")?t:new v(t)}function v(t){this.__wrapped__=t}function S(t,e,n,r){function o(){var r=arguments,c=s?this:e;if(i||(t=e[a]),n.length&&(r=r.length?(r=Pr.call(r),u?r.concat(n):n.concat(r)):n),this instanceof o){c=te(t.prototype);var l=t.apply(c,r);return we(l)?l:c}return t.apply(c,r)}var i=ke(t),s=!n,a=e;if(s){var u=r;n=e}else if(!i){if(!r)throw new rr;e=t}return o}function Z(){var t=c();t.shadowedProps=B,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!Wr;for(var e,n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var o=t.args;t.firstArg=/^[^,]+/.exec(o)[0];var i=Yn("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+o+") {\n"+Dr(t)+"\n}");return h(t),i(X,ir,gr,ue,Gr,Ae,Wr,y,sr,Q,Rr,J,ar,kr)}function te(t){return we(t)?Er(t):{}}function ne(t){return Kr[t]}function oe(){var t=(t=y.indexOf)===sn?e:t;return t}function ie(t){return function(e,n,r,o){return"boolean"!=typeof n&&null!=n&&(o=r,r=o&&o[n]===e?g:n,n=!1),null!=r&&(r=y.createCallback(r,o)),t(e,n,r,o)}}function se(t){var e,n;return!t||kr.call(t)!=z||(e=t.constructor,ke(e)&&!(e instanceof e))||!Mr.argsClass&&ue(t)||!Mr.nodeClass&&l(t)?!1:Mr.ownLast?(Jr(t,function(t,e,r){return n=gr.call(r,e),!1}),n!==!1):(Jr(t,function(t,e){n=e}),n===g||gr.call(t,n))}function ae(t){return Vr[t]}function ue(t){return kr.call(t)==U}function ce(t,e,n,r,o,i){var s=t;if("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),"function"==typeof n){if(n="undefined"==typeof r?n:y.createCallback(n,r,1),s=n(s),"undefined"!=typeof s)return s;s=t}var a=we(s);if(a){var c=kr.call(s);if(!Y[c]||!Mr.nodeClass&&l(s))return s;var f=Gr(s)}if(!a||!e)return a?f?d(s):zr({},s):s;var h=qr[c];switch(c){case H:case W:return new h(+s);case V:case J:return new h(s);case $:return h(s.source,I.exec(s))}var m=!o;o||(o=u()),i||(i=u());for(var v=o.length;v--;)if(o[v]==t)return i[v];return s=f?h(s.length):{},f&&(gr.call(t,"index")&&(s.index=t.index),gr.call(t,"input")&&(s.input=t.input)),o.push(t),i.push(s),(f?Xr:Yr)(t,function(t,r){s[r]=ce(t,e,n,g,o,i)}),m&&(p(o),p(i)),s}function le(t,e,n){return ce(t,!0,e,n)}function fe(t,e,n){var r;return e=y.createCallback(e,n),Yr(t,function(t,n,o){return e(t,n,o)?(r=n,!1):void 0}),r}function pe(t){var e=[];return Jr(t,function(t,n){ke(t)&&e.push(n)}),e.sort()}function he(t,e){return t?gr.call(t,e):!1}function de(t){for(var e=-1,n=Wr(t),r=n.length,o={};++e<r;){var i=n[e];o[t[i]]=i}return o}function me(t){return t===!0||t===!1||kr.call(t)==H}function ge(t){return t?"object"==typeof t&&kr.call(t)==W:!1}function ye(t){return t?1===t.nodeType:!1}function ve(t){var e=!0;if(!t)return e;var n=kr.call(t),r=t.length;return n==G||n==J||(Mr.argsClass?n==U:ue(t))||n==z&&"number"==typeof r&&ke(t.splice)?!r:(Yr(t,function(){return e=!1}),e)}function be(t,e,n,r,o,i){var s=n===_;if("function"==typeof n&&!s){n=y.createCallback(n,r,2);var a=n(t,e);if("undefined"!=typeof a)return!!a}if(t===e)return 0!==t||1/t==1/e;var c=typeof t,f=typeof e;if(t===t&&(!t||"function"!=c&&"object"!=c)&&(!e||"function"!=f&&"object"!=f))return!1;if(null==t||null==e)return t===e;var h=kr.call(t),d=kr.call(e);if(h==U&&(h=z),d==U&&(d=z),h!=d)return!1;switch(h){case H:case W:return+t==+e;case V:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case $:case J:return t==nr(e)}var m=h==G;if(!m){if(gr.call(t,"__wrapped__ ")||gr.call(e,"__wrapped__"))return be(t.__wrapped__||t,e.__wrapped__||e,n,r,o,i);if(h!=z||!Mr.nodeClass&&(l(t)||l(e)))return!1;var g=!Mr.argsObject&&ue(t)?tr:t.constructor,v=!Mr.argsObject&&ue(e)?tr:e.constructor;if(g!=v&&!(ke(g)&&g instanceof g&&ke(v)&&v instanceof v))return!1}var b=!o;o||(o=u()),i||(i=u());for(var k=o.length;k--;)if(o[k]==t)return i[k]==e;var w=0;if(a=!0,o.push(t),i.push(e),m){if(k=t.length,w=e.length,a=w==t.length,!a&&!s)return a;for(;w--;){var E=k,S=e[w];if(s)for(;E--&&!(a=be(t[E],S,n,r,o,i)););else if(!(a=be(t[w],S,n,r,o,i)))break}return a}return Jr(e,function(e,s,u){return gr.call(u,s)?(w++,a=gr.call(t,s)&&be(t[s],e,n,r,o,i)):void 0}),a&&!s&&Jr(t,function(t,e,n){return gr.call(n,e)?a=--w>-1:void 0}),b&&(p(o),p(i)),a}function _e(t){return xr(t)&&!Cr(parseFloat(t))}function ke(t){return"function"==typeof t}function we(t){return!(!t||!Q[typeof t])}function Ee(t){return xe(t)&&t!=+t}function Se(t){return null===t}function xe(t){return"number"==typeof t||kr.call(t)==V}function Ce(t){return!(!t||!Q[typeof t])&&kr.call(t)==$}function Ae(t){return"string"==typeof t||kr.call(t)==J}function Oe(t){return"undefined"==typeof t}function je(t,e,n){var r=arguments,o=0,i=2;if(!we(t))return t;if(n===_)var s=r[3],a=r[4],c=r[5];else{var l=!0;a=u(),c=u(),"number"!=typeof n&&(i=r.length),i>3&&"function"==typeof r[i-2]?s=y.createCallback(r[--i-1],r[i--],2):i>2&&"function"==typeof r[i-1]&&(s=r[--i])}for(;++o<i;)(Gr(r[o])?Ue:Yr)(r[o],function(e,n){var r,o,i=e,u=t[n];if(e&&((o=Gr(e))||Qr(e))){for(var l=a.length;l--;)if(r=a[l]==e){u=c[l];break}if(!r){var f;s&&(i=s(u,e),(f="undefined"!=typeof i)&&(u=i)),f||(u=o?Gr(u)?u:[]:Qr(u)?u:{}),a.push(e),c.push(u),f||(u=je(u,e,_,s,a,c))}}else s&&(i=s(u,e),"undefined"==typeof i&&(i=e)),"undefined"!=typeof i&&(u=i);t[n]=u});return l&&(p(a),p(c)),t}function Ie(t,e,n){var r=oe(),o="function"==typeof e,i={};if(o)e=y.createCallback(e,n);else var s=pr.apply(or,Pr.call(arguments,1));return Jr(t,function(t,n,a){(o?!e(t,n,a):r(s,n)<0)&&(i[n]=t)}),i}function Te(t){for(var e=-1,n=Wr(t),r=n.length,o=Vn(r);++e<r;){var i=n[e];o[e]=[i,t[i]]}return o}function Pe(t,e,n){var r={};if("function"!=typeof e)for(var o=-1,i=pr.apply(or,Pr.call(arguments,1)),s=we(t)?i.length:0;++o<s;){var a=i[o];a in t&&(r[a]=t[a])}else e=y.createCallback(e,n),Jr(t,function(t,n,o){e(t,n,o)&&(r[n]=t)});return r}function Le(t,e,n,r){var o=Gr(t);if(e=y.createCallback(e,r,4),null==n)if(o)n=[];else{var i=t&&t.constructor,s=i&&i.prototype;n=te(s)}return(o?Xr:Yr)(t,function(t,r,o){return e(n,t,r,o)}),n}function Ne(t){for(var e=-1,n=Wr(t),r=n.length,o=Vn(r);++e<r;)o[e]=t[n[e]];return o}function qe(t){var e=-1,n=pr.apply(or,Pr.call(arguments,1)),r=n.length,o=Vn(r);for(Mr.unindexedChars&&Ae(t)&&(t=t.split(""));++e<r;)o[e]=t[n[e]];return o}function Re(t,e,n){var r=-1,o=oe(),i=t?t.length:0,s=!1;return n=(0>n?Or(0,i+n):n)||0,i&&"number"==typeof i?s=(Ae(t)?t.indexOf(e,n):o(t,e,n))>-1:Xr(t,function(t){return++r>=n?!(s=t===e):void 0}),s}function Me(t,e,n){var r={};return e=y.createCallback(e,n),Ue(t,function(t,n,o){n=nr(e(t,n,o)),gr.call(r,n)?r[n]++:r[n]=1}),r}function De(t,e,n){var r=!0;if(e=y.createCallback(e,n),Gr(t))for(var o=-1,i=t.length;++o<i&&(r=!!e(t[o],o,t)););else Xr(t,function(t,n,o){return r=!!e(t,n,o)});return r}function Be(t,e,n){var r=[];if(e=y.createCallback(e,n),Gr(t))for(var o=-1,i=t.length;++o<i;){var s=t[o];e(s,o,t)&&r.push(s)}else Xr(t,function(t,n,o){e(t,n,o)&&r.push(t)});return r}function Fe(t,e,n){if(e=y.createCallback(e,n),!Gr(t)){var r;return Xr(t,function(t,n,o){return e(t,n,o)?(r=t,!1):void 0}),r}for(var o=-1,i=t.length;++o<i;){var s=t[o];if(e(s,o,t))return s}}function Ue(t,e,n){if(e&&"undefined"==typeof n&&Gr(t))for(var r=-1,o=t.length;++r<o&&e(t[r],r,t)!==!1;);else Xr(t,e,n);return t}function Ge(t,e,n){var r={};return e=y.createCallback(e,n),Ue(t,function(t,n,o){n=nr(e(t,n,o)),(gr.call(r,n)?r[n]:r[n]=[]).push(t)}),r}function He(t,e){var n=Pr.call(arguments,2),r=-1,o="function"==typeof e,i=t?t.length:0,s=Vn("number"==typeof i?i:0);return Ue(t,function(t){s[++r]=(o?e:t[e]).apply(t,n)}),s}function We(t,e,n){var r=-1,o=t?t.length:0,i=Vn("number"==typeof o?o:0);if(e=y.createCallback(e,n),Gr(t))for(;++r<o;)i[r]=e(t[r],r,t);else Xr(t,function(t,n,o){i[++r]=e(t,n,o)});return i}function Xe(t,e,n){var r=-1/0,i=r;if(!e&&Gr(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];u>i&&(i=u)}else e=!e&&Ae(t)?o:y.createCallback(e,n),Xr(t,function(t,n,o){var s=e(t,n,o);s>r&&(r=s,i=t)});return i}function Ke(t,e,n){var r=1/0,i=r;if(!e&&Gr(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];i>u&&(i=u)}else e=!e&&Ae(t)?o:y.createCallback(e,n),Xr(t,function(t,n,o){var s=e(t,n,o);r>s&&(r=s,i=t)});return i}function Ve(t,e,n,r){var o=arguments.length<3;if(e=y.createCallback(e,r,4),Gr(t)){var i=-1,s=t.length;for(o&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t)}else Xr(t,function(t,r,i){n=o?(o=!1,t):e(n,t,r,i)});return n}function ze(t,e,n,r){var o=t,i=t?t.length:0,s=arguments.length<3;if("number"!=typeof i){var a=Wr(t);i=a.length}else Mr.unindexedChars&&Ae(t)&&(o=t.split(""));return e=y.createCallback(e,r,4),Ue(t,function(t,r,u){r=a?a[--i]:--i,n=s?(s=!1,o[r]):e(n,o[r],r,u)}),n}function $e(t,e,n){return e=y.createCallback(e,n),Be(t,function(t,n,r){return!e(t,n,r)})}function Je(t){var e=-1,n=t?t.length:0,r=Vn("number"==typeof n?n:0);return Ue(t,function(t){var n=hr(Tr()*(++e+1));r[e]=r[n],r[n]=t}),r}function Ye(t){var e=t?t.length:0;return"number"==typeof e?e:Wr(t).length}function Qe(t,e,n){var r;if(e=y.createCallback(e,n),Gr(t))for(var o=-1,i=t.length;++o<i&&!(r=e(t[o],o,t)););else Xr(t,function(t,n,o){return!(r=e(t,n,o))});return!!r}function Ze(t,e,n){var r=-1,o=t?t.length:0,s=Vn("number"==typeof o?o:0);for(e=y.createCallback(e,n),Ue(t,function(t,n,o){var i=s[++r]=c();i.criteria=e(t,n,o),i.index=r,i.value=t}),o=s.length,s.sort(i);o--;){var a=s[o];s[o]=a.value,h(a)}return s}function tn(t){return t&&"number"==typeof t.length?Mr.unindexedChars&&Ae(t)?t.split(""):d(t):Ne(t)}function en(t){for(var e=-1,n=t?t.length:0,r=[];++e<n;){var o=t[e];o&&r.push(o)}return r}function nn(t){var r=-1,o=oe(),i=t?t.length:0,a=pr.apply(or,Pr.call(arguments,1)),u=[],c=i>=E&&o===e;if(c){var l=s(a);l?(o=n,a=l):c=!1}for(;++r<i;){var f=t[r];o(a,f)<0&&u.push(f)}return c&&h(a),u}function rn(t,e,n){var r=-1,o=t?t.length:0;for(e=y.createCallback(e,n);++r<o;)if(e(t[r],r,t))return r;return-1}function on(t,e,n){if(t){var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=-1;for(e=y.createCallback(e,n);++i<o&&e(t[i],i,t);)r++}else if(r=e,null==r||n)return t[0];return d(t,0,jr(Or(0,r),o))}}function sn(t,n,r){if("number"==typeof r){var o=t?t.length:0;r=0>r?Or(0,o+r):r||0}else if(r){var i=hn(t,n);return t[i]===n?i:-1}return t?e(t,n,r):-1}function an(t,e,n){if(!t)return[];var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=o;for(e=y.createCallback(e,n);i--&&e(t[i],i,t);)r++}else r=null==e||n?1:e||r;return d(t,0,jr(Or(0,o-r),o))}function un(t){for(var r=arguments,o=r.length,i=-1,a=u(),c=-1,l=oe(),f=t?t.length:0,d=[],m=u();++i<o;){var g=r[i];a[i]=l===e&&(g?g.length:0)>=E&&s(i?r[i]:m)}t:for(;++c<f;){var y=a[0];if(g=t[c],(y?n(y,g):l(m,g))<0){for(i=o,(y||m).push(g);--i;)if(y=a[i],(y?n(y,g):l(r[i],g))<0)continue t;d.push(g)}}for(;o--;)y=a[o],y&&h(y);return p(a),p(m),d}function cn(t,e,n){if(t){var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=o;for(e=y.createCallback(e,n);i--&&e(t[i],i,t);)r++}else if(r=e,null==r||n)return t[o-1];return d(t,Or(0,o-r))}}function ln(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?Or(0,r+n):jr(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function fn(t,e,n){t=+t||0,n=+n||1,null==e&&(e=t,t=0);for(var r=-1,o=Or(0,lr((e-t)/n)),i=Vn(o);++r<o;)i[r]=t,t+=n;return i}function pn(t,e,n){if("number"!=typeof e&&null!=e){var r=0,o=-1,i=t?t.length:0;for(e=y.createCallback(e,n);++o<i&&e(t[o],o,t);)r++}else r=null==e||n?1:Or(0,e);return d(t,r)}function hn(t,e,n,r){var o=0,i=t?t.length:o;for(n=n?y.createCallback(n,r,1):qn,e=n(e);i>o;){var s=o+i>>>1;n(t[s])<e?o=s+1:i=s}return o}function dn(t){return Gr(t)||(arguments[0]=t?Pr.call(t):or),no(pr.apply(or,arguments))}function mn(t){for(var e=-1,n=t?Xe(Zr(t,"length")):0,r=Vn(0>n?0:n);++e<n;)r[e]=Zr(t,e);return r}function gn(t){return nn(t,Pr.call(arguments,1))}function yn(t){return t?mn(arguments):[]}function vn(t,e){for(var n=-1,r=t?t.length:0,o={};++n<r;){var i=t[n];e?o[i]=e[n]:o[i[0]]=i[1]}return o}function bn(t,e){return 1>t?e():function(){return--t<1?e.apply(this,arguments):void 0}}function _n(t,e){return Mr.fastBind||wr&&arguments.length>2?wr.call.apply(wr,arguments):S(t,e,Pr.call(arguments,2))}function kn(t){for(var e=arguments.length>1?pr.apply(or,Pr.call(arguments,1)):pe(t),n=-1,r=e.length;++n<r;){var o=e[n];t[o]=_n(t[o],t)}return t}function wn(t,e){return S(t,e,Pr.call(arguments,2),_)}function En(){var t=arguments;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function Sn(t,e,n){if(null==t)return qn;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var o=Wr(t);return function(e){for(var n=o.length,r=!1;n--&&(r=be(e[o[n]],t[o[n]],_)););return r}}return"undefined"==typeof e||P&&!P.test(dr.call(t))?t:1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,o,i){return t.call(e,n,r,o,i)}:function(n,r,o){return t.call(e,n,r,o)}}function xn(t,e,n){function r(){fr(p),fr(h),c=0,p=h=null}function o(){var e=d&&(!m||c>1);r(),e&&(f!==!1&&(l=new $n),a=t.apply(u,s))}function i(){r(),(d||f!==e)&&(l=new $n,a=t.apply(u,s))}var s,a,u,c=0,l=0,f=!1,p=null,h=null,d=!0;if(e=Or(0,e||0),n===!0){var m=!0;d=!1}else we(n)&&(m=n.leading,f="maxWait"in n&&Or(e,n.maxWait||0),d="trailing"in n?n.trailing:d);return function(){if(s=arguments,u=this,c++,fr(h),f===!1)m&&2>c&&(a=t.apply(u,s));else{var n=new $n;p||m||(l=n);var r=f-(n-l);0>=r?(fr(p),p=null,l=n,a=t.apply(u,s)):p||(p=_r(i,r))}return e!==f&&(h=_r(o,e)),a}}function Cn(t){var e=Pr.call(arguments,1);return _r(function(){t.apply(g,e)},1)}function An(t,e){var n=Pr.call(arguments,2);return _r(function(){t.apply(g,n)},e)}function On(t,e){function n(){var r=n.cache,o=w+(e?e.apply(this,arguments):arguments[0]);return gr.call(r,o)?r[o]:r[o]=t.apply(this,arguments)}return n.cache={},n}function jn(t){var e,n;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function In(t){return S(t,Pr.call(arguments,1))}function Tn(t){return S(t,Pr.call(arguments,1),null,_)}function Pn(t,e,n){var r=!0,o=!0;n===!1?r=!1:we(n)&&(r="leading"in n?n.leading:r,o="trailing"in n?n.trailing:o),n=c(),n.leading=r,n.maxWait=e,n.trailing=o;var i=xn(t,e,n);return h(n),i}function Ln(t,e){return function(){var n=[t];return yr.apply(n,arguments),e.apply(this,n)}}function Nn(t){return null==t?"":nr(t).replace(R,ne)}function qn(t){return t}function Rn(t){Ue(pe(t),function(e){var n=y[e]=t[e];y.prototype[e]=function(){var t=this.__wrapped__,e=[t];yr.apply(e,arguments);var r=n.apply(y,e);return t&&"object"==typeof t&&t===r?this:new v(r)}})}function Mn(){return r._=ur,this}function Dn(t,e){null==t&&null==e&&(e=1),t=+t||0,null==e?(e=t,t=0):e=+e||0;var n=Tr();return t%1||e%1?t+jr(n*(e-t+parseFloat("1e-"+((n+"").length-1))),e):t+hr(n*(e-t+1))}function Bn(t,e){var n=t?t[e]:g;return ke(n)?t[e]():n}function Fn(t,e,n){var r=y.templateSettings;t||(t=""),n=$r({},n,r);var o,i=$r({},n.imports,r.imports),s=Wr(i),u=Ne(i),c=0,l=n.interpolate||q,f="__p += '",p=er((n.escape||q).source+"|"+l.source+"|"+(l===T?j:q).source+"|"+(n.evaluate||q).source+"|$","g");t.replace(p,function(e,n,r,i,s,u){return r||(r=i),f+=t.slice(c,u).replace(M,a),n&&(f+="' +\n__e("+n+") +\n'"),s&&(o=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e}),f+="';\n";var h=n.variable,d=h;d||(h="obj",f="with ("+h+") {\n"+f+"\n}\n"),f=(o?f.replace(x,""):f).replace(C,"$1").replace(A,"$1;"),f="function("+h+") {\n"+(d?"":h+" || ("+h+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m="\n/*\n//@ sourceURL="+(n.sourceURL||"/lodash/template/source["+F++ +"]")+"\n*/";try{var v=Yn(s,"return "+f+m).apply(g,u)}catch(b){throw b.source=f,b}return e?v(e):(v.source=f,v)}function Un(t,e,n){t=(t=+t)>-1?t:0;var r=-1,o=Vn(t);for(e=y.createCallback(e,n,1);++r<t;)o[r]=e(r);return o}function Gn(t){return null==t?"":nr(t).replace(O,ae)}function Hn(t){var e=++b;return nr(null==t?"":t)+e}function Wn(t,e){return e(t),t}function Xn(){return nr(this.__wrapped__)}function Kn(){return this.__wrapped__}r=r?re.defaults(t.Object(),r,re.pick(t,D)):t;var Vn=r.Array,zn=r.Boolean,$n=r.Date,Jn=r.Error,Yn=r.Function,Qn=r.Math,Zn=r.Number,tr=r.Object,er=r.RegExp,nr=r.String,rr=r.TypeError,or=[],ir=Jn.prototype,sr=tr.prototype,ar=nr.prototype,ur=r._,cr=er("^"+nr(sr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),lr=Qn.ceil,fr=r.clearTimeout,pr=or.concat,hr=Qn.floor,dr=Yn.prototype.toString,mr=cr.test(mr=tr.getPrototypeOf)&&mr,gr=sr.hasOwnProperty,yr=or.push,vr=sr.propertyIsEnumerable,br=r.setImmediate,_r=r.setTimeout,kr=sr.toString,wr=cr.test(wr=kr.bind)&&wr,Er=cr.test(Er=tr.create)&&Er,Sr=cr.test(Sr=Vn.isArray)&&Sr,xr=r.isFinite,Cr=r.isNaN,Ar=cr.test(Ar=tr.keys)&&Ar,Or=Qn.max,jr=Qn.min,Ir=r.parseInt,Tr=Qn.random,Pr=or.slice,Lr=cr.test(r.attachEvent),Nr=wr&&!/\n|true/.test(wr+Lr),qr={};qr[G]=Vn,qr[H]=zn,qr[W]=$n,qr[K]=Yn,qr[z]=tr,qr[V]=Zn,qr[$]=er,qr[J]=nr;var Rr={};Rr[G]=Rr[W]=Rr[V]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Rr[H]=Rr[J]={constructor:!0,toString:!0,valueOf:!0},Rr[X]=Rr[K]=Rr[$]={constructor:!0,toString:!0},Rr[z]={constructor:!0},function(){for(var t=B.length;t--;){var e=B[t];for(var n in Rr)gr.call(Rr,n)&&!gr.call(Rr[n],e)&&(Rr[n][e]=!1)}}(),v.prototype=y.prototype;var Mr=y.support={};!function(){var t=function(){this.x=1},e={0:1,length:1},n=[];t.prototype={valueOf:1,y:1};for(var r in new t)n.push(r);for(r in arguments);Mr.argsObject=arguments.constructor==tr&&!(arguments instanceof Vn),Mr.argsClass=ue(arguments),Mr.enumErrorProps=vr.call(ir,"message")||vr.call(ir,"name"),Mr.enumPrototypes=vr.call(t,"prototype"),Mr.fastBind=wr&&!Nr,Mr.ownLast="x"!=n[0],Mr.nonEnumArgs=0!=r,Mr.nonEnumShadows=!/valueOf/.test(n),Mr.spliceObjects=(or.splice.call(e,0,1),!e[0]),Mr.unindexedChars="xx"!="x"[0]+tr("x")[0];try{Mr.nodeClass=!(kr.call(document)==z&&!({toString:0}+""))}catch(o){Mr.nodeClass=!0}}(1),y.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:T,variable:"",imports:{_:y}};var Dr=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",Mr.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):Mr.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),Mr.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),Mr.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(Mr.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Mr.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",Mr.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||Mr.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},Br={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Fr={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Ur={top:"if (!objectTypes[typeof iterable]) return result;\n"+Fr.top,array:!1};if(!Er)var te=function(t){if(we(t)){f.prototype=t;var e=new f;f.prototype=null}return e||{}};Mr.argsClass||(ue=function(t){return t?gr.call(t,"callee"):!1});var Gr=Sr||function(t){return t?"object"==typeof t&&kr.call(t)==G:!1},Hr=Z({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Wr=Ar?function(t){return we(t)?Mr.enumPrototypes&&"function"==typeof t||Mr.nonEnumArgs&&t.length&&ue(t)?Hr(t):Ar(t):[]}:Hr,Xr=Z(Fr),Kr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Vr=de(Kr),zr=Z(Br,{top:Br.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),$r=Z(Br),Jr=Z(Fr,Ur,{useHas:!1}),Yr=Z(Fr,Ur);ke(/x/)&&(ke=function(t){return"function"==typeof t&&kr.call(t)==K});var Qr=mr?function(t){if(!t||kr.call(t)!=z||!Mr.argsClass&&ue(t))return!1;var e=t.valueOf,n="function"==typeof e&&(n=mr(e))&&mr(n);return n?t==n||mr(t)==n:se(t)}:se,Zr=We,to=Be,eo=ie(function oo(t,e,n){for(var r=-1,o=t?t.length:0,i=[];++r<o;){var s=t[r];n&&(s=n(s,r,t)),Gr(s)?yr.apply(i,e?s:oo(s)):i.push(s)}return i}),no=ie(function(t,r,o){var i=-1,a=oe(),c=t?t.length:0,l=[],f=!r&&c>=E&&a===e,d=o||f?u():l;if(f){var m=s(d);m?(a=n,d=m):(f=!1,d=o?d:(p(d),l))}for(;++i<c;){var g=t[i],y=o?o(g,i,t):g;(r?!i||d[d.length-1]!==y:a(d,y)<0)&&((o||f)&&d.push(y),l.push(g))}return f?(p(d.array),h(d)):o&&p(d),l});Nr&&ee&&"function"==typeof br&&(Cn=_n(br,r));var ro=8==Ir(L+"08")?Ir:function(t,e){return Ir(Ae(t)?t.replace(N,""):t,e||0)};return y.after=bn,y.assign=zr,y.at=qe,y.bind=_n,y.bindAll=kn,y.bindKey=wn,y.compact=en,y.compose=En,y.countBy=Me,y.createCallback=Sn,y.debounce=xn,y.defaults=$r,y.defer=Cn,y.delay=An,y.difference=nn,y.filter=Be,y.flatten=eo,y.forEach=Ue,y.forIn=Jr,y.forOwn=Yr,y.functions=pe,y.groupBy=Ge,y.initial=an,y.intersection=un,y.invert=de,y.invoke=He,y.keys=Wr,y.map=We,y.max=Xe,y.memoize=On,y.merge=je,y.min=Ke,y.omit=Ie,y.once=jn,y.pairs=Te,y.partial=In,y.partialRight=Tn,y.pick=Pe,y.pluck=Zr,y.range=fn,y.reject=$e,y.rest=pn,y.shuffle=Je,y.sortBy=Ze,y.tap=Wn,y.throttle=Pn,y.times=Un,y.toArray=tn,y.transform=Le,y.union=dn,y.uniq=no,y.unzip=mn,y.values=Ne,y.where=to,y.without=gn,y.wrap=Ln,y.zip=yn,y.zipObject=vn,y.collect=We,y.drop=pn,y.each=Ue,y.extend=zr,y.methods=pe,y.object=vn,y.select=Be,y.tail=pn,y.unique=no,Rn(y),y.chain=y,y.prototype.chain=function(){return this},y.clone=ce,y.cloneDeep=le,y.contains=Re,y.escape=Nn,y.every=De,y.find=Fe,y.findIndex=rn,y.findKey=fe,y.has=he,y.identity=qn,y.indexOf=sn,y.isArguments=ue,y.isArray=Gr,y.isBoolean=me,y.isDate=ge,y.isElement=ye,y.isEmpty=ve,y.isEqual=be,y.isFinite=_e,y.isFunction=ke,y.isNaN=Ee,y.isNull=Se,y.isNumber=xe,y.isObject=we,y.isPlainObject=Qr,y.isRegExp=Ce,y.isString=Ae,y.isUndefined=Oe,y.lastIndexOf=ln,y.mixin=Rn,y.noConflict=Mn,y.parseInt=ro,y.random=Dn,y.reduce=Ve,y.reduceRight=ze,y.result=Bn,y.runInContext=m,y.size=Ye,y.some=Qe,y.sortedIndex=hn,y.template=Fn,y.unescape=Gn,y.uniqueId=Hn,y.all=De,y.any=Qe,y.detect=Fe,y.findWhere=Fe,y.foldl=Ve,y.foldr=ze,y.include=Re,y.inject=Ve,Yr(y,function(t,e){y.prototype[e]||(y.prototype[e]=function(){var e=[this.__wrapped__];return yr.apply(e,arguments),t.apply(y,e)})}),y.first=on,y.last=cn,y.take=on,y.head=on,Yr(y,function(t,e){y.prototype[e]||(y.prototype[e]=function(e,n){var r=t(this.__wrapped__,e,n);return null==e||n&&"function"!=typeof e?r:new v(r)})}),y.VERSION="1.3.1",y.prototype.toString=Xn,y.prototype.value=Kn,y.prototype.valueOf=Kn,Xr(["join","pop","shift"],function(t){var e=or[t];y.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),Xr(["push","reverse","sort","unshift"],function(t){var e=or[t];y.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Xr(["concat","slice","splice"],function(t){var e=or[t];y.prototype[t]=function(){return new v(e.apply(this.__wrapped__,arguments))}}),Mr.spliceObjects||Xr(["pop","shift","splice"],function(t){var e=or[t],n="splice"==t;y.prototype[t]=function(){var t=this.__wrapped__,r=e.apply(t,arguments);return 0===t.length&&delete t[0],n?new v(r):r}}),y}var g,y=[],v=[],b=0,_={},w=+new Date+"",E=75,S=40,x=/\b__p \+= '';/g,C=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,O=/&(?:amp|lt|gt|quot|#39);/g,j=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,I=/\w*$/,T=/<%=([\s\S]+?)%>/g,P=(P=/\bthis\b/)&&P.test(m)&&P,L="    \f ﻿\n\r\u2028\u2029 ᠎             　",N=RegExp("^["+L+"]*0+(?=.$)"),q=/($^)/,R=/[&<>"']/g,M=/['\n\r\t\u2028\u2029\\]/g,D=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],B=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F=0,U="[object Arguments]",G="[object Array]",H="[object Boolean]",W="[object Date]",X="[object Error]",K="[object Function]",V="[object Number]",z="[object Object]",$="[object RegExp]",J="[object String]",Y={};Y[K]=!1,Y[U]=Y[G]=Y[H]=Y[W]=Y[V]=Y[z]=Y[$]=Y[J]=!0;var Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r"," ":"t","\u2028":"u2028","\u2029":"u2029"},te=Q[typeof exports]&&exports,ee=Q[typeof module]&&module&&module.exports==te&&module,ne=Q[typeof global]&&global;!ne||ne.global!==ne&&ne.window!==ne||(t=ne);var re=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t._=re,define("lodash",[],function(){return re})):te&&!te.nodeType?ee?(ee.exports=re)._=re:te._=re:t._=re}(this),define("hide_lodash",["lodash"],function(t){t.noConflict()}),define("iefix",[],function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1})}),define("global/window",[],function(){return window}),!function(t){function e(){this._events={},this._conf&&n.call(this,this._conf)}function n(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function r(t){this._events={},this.newListener=!1,n.call(this,t)}function o(t,e,n,r){if(!n)return[];var i,s,a,u,c,l,f,p=[],h=e.length,d=e[r],m=e[r+1];if(r===h&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(i=0,s=n._listeners.length;s>i;i++)t&&t.push(n._listeners[i]);
return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(p=p.concat(o(t,e,n[a],r+1)));return p}if("**"===d){f=r+1===h||r+2===h&&"*"===m,f&&n._listeners&&(p=p.concat(o(t,e,n,h)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!f&&(p=p.concat(o(t,e,n[a],h))),p=p.concat(o(t,e,n[a],r))):p=a===m?p.concat(o(t,e,n[a],r+2)):p.concat(o(t,e,n[a],r)));return p}p=p.concat(o(t,e,n[d],r+1))}if(u=n["*"],u&&o(t,e,u,r+1),c=n["**"])if(h>r){c._listeners&&o(t,e,c,h);for(a in c)"_listeners"!==a&&c.hasOwnProperty(a)&&(a===m?o(t,e,c[a],r+2):a===d?o(t,e,c[a],r+1):(l={},l[a]=c[a],o(t,e,{"**":l},r+1)))}else c._listeners?o(t,e,c,h):c["*"]&&c["*"]._listeners&&o(t,e,c["*"],h);return p}function i(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var o=this.listenerTree,i=t.shift();i;){if(o[i]||(o[i]={}),o=o[i],0===t.length){if(o._listeners){if("function"==typeof o._listeners)o._listeners=[o._listeners,e];else if(s(o._listeners)&&(o._listeners.push(e),!o._listeners.warned)){var u=a;"undefined"!=typeof this._events.maxListeners&&(u=this._events.maxListeners),u>0&&o._listeners.length>u&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}else o._listeners=e;return!0}i=t.shift()}return!0}var s=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},r.prototype.event="",r.prototype.once=function(t,e){return this.many(t,1,e),this},r.prototype.many=function(t,e,n){function r(){0===--e&&o.off(t,r),n.apply(this,arguments)}var o=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),o},r.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];for(i=0,n=this._all.length;n>i;i++)this.event=t,this._all[i].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();o.call(this,s,a,this.listenerTree,0)}else s=this._events[t];if("function"==typeof s){if(this.event=t,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];s.apply(this,r)}return!0}if(s){for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];for(var u=s.slice(),i=0,n=u.length;n>i;i++)this.event=t,u[i].apply(this,r);return u.length>0||this._all}return this._all},r.prototype.on=function(t,n){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,n),this.wildcard)return i.call(this,t,n),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],n];else if(s(this._events[t])&&(this._events[t].push(n),!this._events[t].warned)){var r=a;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=n;return this},r.prototype.onAny=function(t){if(this._all||(this._all=[]),"function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all.push(t),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof t?t.split(this.delimiter):t.slice();r=o.call(this,null,i,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var u=r[a];if(n=u._listeners,s(n)){for(var c=-1,l=0,f=n.length;f>l;l++)if(n[l]===e||n[l].listener&&n[l].listener===e||n[l]._origin&&n[l]._origin===e){c=l;break}if(0>c)return this;this.wildcard?u._listeners.splice(c,1):this._events[t].splice(c,1),0===n.length&&(this.wildcard?delete u._listeners:delete this._events[t])}else(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},r.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),r=o.call(this,null,n,this.listenerTree,0),i=0;i<r.length;i++){var s=r[i];s._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return o.call(this,n,r,this.listenerTree,0),n}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter2",[],function(){return r}):t.EventEmitter2=r}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),function(){var t={};t.constructor=function(){};var e=this;t.register=function(){function t(t){return function(){o++||(e(),t&&t.apply(this,arguments))}}function e(){if(n){for(var t=0;r>t;t+=3){var e=n[t],o=n[t+1],i=n[t+2];e.removeListener?e.removeListener(o,i):e.off(o,i)}n=null}}var n=1===arguments.length?arguments[0]:arguments,r=n.length;if(0!==r%3)throw new Error("register needs triplets as arguments");for(var o=0,i=0;r>i;i+=3){var s=n[i],a=n[i+1],u=n[i+2];"!"==a.substr(0,1)&&(a=n[i+1]=a.substr(1),u=n[i+2]=t(u)),s.addListener?s.addListener(a,u):s.on(a,u)}return e},t.singular=function(t){return function(){if(t){var e=t;return t=null,e.apply(this,arguments)}}},"undefined"!=typeof define&&define.amd?define("eventutil",[],function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:e.eventutil=t}(),define("global/json",["global/window"],function(t){return t.JSON}),function(){function t(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(e,arguments)}}var e,n,r={};e=this,null!=e&&(n=e.async),r.noConflict=function(){return e.async=n,r};var o=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n+=1)e(t[n],n,t)},i=function(t,e){if(t.map)return t.map(e);var n=[];return o(t,function(t,r,o){n.push(e(t,r,o))}),n},s=function(t,e,n){return t.reduce?t.reduce(e,n):(o(t,function(t,r,o){n=e(n,t,r,o)}),n)},a=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,r.setImmediate="undefined"!=typeof setImmediate?setImmediate:r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(t){setImmediate(t)},r.setImmediate=r.nextTick):(r.nextTick=function(t){setTimeout(t,0)},r.setImmediate=r.nextTick),r.each=function(e,n,r){if(r=r||function(){},!e.length)return r();var i=0;o(e,function(o){n(o,t(function(t){t?(r(t),r=function(){}):(i+=1,i>=e.length&&r(null))}))})},r.forEach=r.each,r.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,o=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length?n(null):o())})};o()},r.forEachSeries=r.eachSeries,r.eachLimit=function(t,e,n,r){var o=u(e);o.apply(null,[t,n,r])},r.forEachLimit=r.eachLimit;var u=function(t){return function(e,n,r){if(r=r||function(){},!e.length||0>=t)return r();var o=0,i=0,s=0;!function a(){if(o>=e.length)return r();for(;t>s&&i<e.length;)i+=1,s+=1,n(e[i-1],function(t){t?(r(t),r=function(){}):(o+=1,s-=1,o>=e.length?r():a())})}()}},c=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.each].concat(e))}},l=function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[u(t)].concat(n))}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.eachSeries].concat(e))}},p=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n,r){o[t.index]=r,e(n)})},function(t){r(t,o)})};r.map=c(p),r.mapSeries=f(p),r.mapLimit=function(t,e,n,r){return h(e)(t,n,r)};var h=function(t){return l(t,p)};r.reduce=function(t,e,n,o){r.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){o(t,e)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(t,e,n,o){var s=i(t,function(t){return t}).reverse();r.reduce(s,e,n,o)},r.foldr=r.reduceRight;var d=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n&&o.push(t),e()})},function(){r(i(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.filter=c(d),r.filterSeries=f(d),r.select=r.filter,r.selectSeries=r.filterSeries;var m=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n||o.push(t),e()})},function(){r(i(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.reject=c(m),r.rejectSeries=f(m);var g=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(){r()})};r.detect=c(g),r.detectSeries=f(g),r.some=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(){n(!1)})},r.any=r.some,r.every=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(){n(!0)})},r.all=r.every,r.sortBy=function(t,e,n){r.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);var r=function(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0};n(null,i(e.sort(r),function(t){return t.value}))})},r.auto=function(t,e){e=e||function(){};var n=a(t);if(!n.length)return e(null);var i={},u=[],c=function(t){u.unshift(t)},l=function(t){for(var e=0;e<u.length;e+=1)if(u[e]===t)return u.splice(e,1),void 0},f=function(){o(u.slice(0),function(t){t()})};c(function(){a(i).length===n.length&&(e(null,i),e=function(){})}),o(n,function(n){var u=t[n]instanceof Function?[t[n]]:t[n],p=function(t){var s=Array.prototype.slice.call(arguments,1);if(s.length<=1&&(s=s[0]),t){var u={};o(a(i),function(t){u[t]=i[t]}),u[n]=s,e(t,u),e=function(){}}else i[n]=s,r.setImmediate(f)},h=u.slice(0,Math.abs(u.length-1))||[],d=function(){return s(h,function(t,e){return t&&i.hasOwnProperty(e)},!0)&&!i.hasOwnProperty(n)};if(d())u[u.length-1](p,i);else{var m=function(){d()&&(l(m),u[u.length-1](p,i))};c(m)}})},r.waterfall=function(t,e){if(e=e||function(){},t.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var o=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var i=Array.prototype.slice.call(arguments,1),s=t.next();s?i.push(o(s)):i.push(e),r.setImmediate(function(){t.apply(null,i)})}}};o(r.iterator(t))()};var y=function(t,e,n){if(n=n||function(){},e.constructor===Array)t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(a(e),function(t,n){e[t](function(e){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),r[t]=o,n(e)})},function(t){n(t,r)})}};r.parallel=function(t,e){y({map:r.map,each:r.each},t,e)},r.parallelLimit=function(t,e,n){y({map:h(e),each:u(e)},t,n)},r.series=function(t,e){if(e=e||function(){},t.constructor===Array)r.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};r.eachSeries(a(t),function(e,r){t[e](function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),n[e]=o,r(t)})},function(t){e(t,n)})}},r.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},r.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var v=function(t,e,n,r){var o=[];t(e,function(t,e){n(t,function(t,n){o=o.concat(n||[]),e(t)})},function(t){r(t,o)})};r.concat=c(v),r.concatSeries=f(v),r.whilst=function(t,e,n){t()?e(function(o){return o?n(o):(r.whilst(t,e,n),void 0)}):n()},r.doWhilst=function(t,e,n){t(function(o){return o?n(o):(e()?r.doWhilst(t,e,n):n(),void 0)})},r.until=function(t,e,n){t()?n():e(function(o){return o?n(o):(r.until(t,e,n),void 0)})},r.doUntil=function(t,e,n){t(function(o){return o?n(o):(e()?n():r.doUntil(t,e,n),void 0)})},r.queue=function(e,n){function i(t,e,i,s){e.constructor!==Array&&(e=[e]),o(e,function(e){var o={data:e,callback:"function"==typeof s?s:null};i?t.tasks.unshift(o):t.tasks.push(o),t.saturated&&t.tasks.length===n&&t.saturated(),r.setImmediate(t.process)})}void 0===n&&(n=1);var s=0,a={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(t,e){i(a,t,!1,e)},unshift:function(t,e){i(a,t,!0,e)},process:function(){if(s<a.concurrency&&a.tasks.length){var n=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),s+=1;var r=function(){s-=1,n.callback&&n.callback.apply(n,arguments),a.drain&&0===a.tasks.length+s&&a.drain(),a.process()},o=t(r);e(n.data,o)}},length:function(){return a.tasks.length},running:function(){return s}};return a},r.cargo=function(t,e){var n=!1,s=[],a={tasks:s,payload:e,saturated:null,empty:null,drain:null,push:function(t,n){t.constructor!==Array&&(t=[t]),o(t,function(t){s.push({data:t,callback:"function"==typeof n?n:null}),a.saturated&&s.length===e&&a.saturated()}),r.setImmediate(a.process)},process:function u(){if(!n){if(0===s.length)return a.drain&&a.drain(),void 0;var r="number"==typeof e?s.splice(0,e):s.splice(0),c=i(r,function(t){return t.data});a.empty&&a.empty(),n=!0,t(c,function(){n=!1;var t=arguments;o(r,function(e){e.callback&&e.callback.apply(null,t)}),u()})}},length:function(){return s.length},running:function(){return n}};return a};var b=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&o(n,function(e){console[t](e)}))}]))}};r.log=b("log"),r.dir=b("dir"),r.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),i=o.pop(),s=e.apply(null,o);s in n?i.apply(null,n[s]):s in r?r[s].push(i):(r[s]=[i],t.apply(null,o.concat([function(){n[s]=arguments;var t=r[s];delete r[s];for(var e=0,o=t.length;o>e;e++)t[e].apply(null,arguments)}])))};return o.memo=n,o.unmemoized=t,o},r.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},r.times=function(t,e,n){for(var o=[],i=0;t>i;i++)o.push(i);return r.map(o,e,n)},r.timesSeries=function(t,e,n){for(var o=[],i=0;t>i;i++)o.push(i);return r.mapSeries(o,e,n)},r.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var e=this,n=Array.prototype.slice.call(arguments),o=n.pop();r.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){o.apply(e,[t].concat(n))})}};var _=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),o=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},o)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};r.applyEach=c(_),r.applyEachSeries=f(_),r.forever=function(t,e){function n(r){if(r){if(e)return e(r);throw r}t(n)}n()},"undefined"!=typeof define&&define.amd?define("async",[],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.async=r}(),define("sharedConfig",[],function(){var t={};return t.version="1.9.5",t.serverUrl="https://goinstant.net",t.domain="goinstant.net",t.httpsOnly="true"==="True".toLowerCase(),t.componentsUrl="https://cdn.goinstant.net/components/",t.isBarista=window?!!window.isBarista:!1,t.isBarista&&(t.httpsOnly=!1),t}),define("util/guard",["lodash","global/window"],function(t,e){var n={};return n.one=function(n,r){if(!n)throw new Error("Attempted to guard a function that did not exist.");if(!t.isFunction(n))throw new Error("Attempted to guard a property that is not a function");if(!r)throw new Error("Context was not passed to guard");return function(){try{n.apply(r,arguments)}catch(t){e.setTimeout(function(){throw t},0)}}},n.all=function(e,r){t.each(r,function(t){e[t]=n.one(e[t],e)})},n}),function(){function t(e,n,r){var o=t.resolve(e);if(null==o){r=r||e,n=n||"root";var i=new Error('Failed to require "'+r+'" from "'+n+'"');throw i.path=r,i.parent=n,i.require=!0,i}var s=t.modules[o];return s.exports||(s.exports={},s.client=s.component=!0,s.call(this,s.exports,t.relative(o),s)),s.exports}if(t.modules={},t.aliases={},t.resolve=function(e){"/"===e.charAt(0)&&(e=e.slice(1));for(var n=e+"/index.js",r=[e,e+".js",e+".json",e+"/index.js",e+"/index.json"],o=0;o<r.length;o++){var e=r[o];if(t.modules.hasOwnProperty(e))return e}return t.aliases.hasOwnProperty(n)?t.aliases[n]:void 0},t.normalize=function(t,e){var n=[];if("."!=e.charAt(0))return e;t=t.split("/"),e=e.split("/");for(var r=0;r<e.length;++r)".."==e[r]?t.pop():"."!=e[r]&&""!=e[r]&&n.push(e[r]);return t.concat(n).join("/")},t.register=function(e,n){t.modules[e]=n},t.alias=function(e,n){if(!t.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');t.aliases[n]=e},t.relative=function(e){function n(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function r(n){var o=r.resolve(n);return t(o,e,n)}var o=t.normalize(e,"..");return r.resolve=function(r){var i=r.charAt(0);if("/"==i)return r.slice(1);if("."==i)return t.normalize(o,r);var s=e.split("/"),a=n(s,"deps")+1;return a||(a=0),r=s.slice(0,a+1).join("/")+"/deps/"+r},r.exists=function(e){return t.modules.hasOwnProperty(r.resolve(e))},r},t.register("component-emitter/index.js",function(t,e,n){function r(t){return t?o(t):void 0}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}n.exports=r,r.prototype.on=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},e._off=n,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;var r=n.indexOf(e._off||e);return~r&&n.splice(r,1),this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,o=n.length;o>r;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),t.register("component-indexof/index.js",function(t,e,n){var r=[].indexOf;n.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}}),t.register("LearnBoost-engine.io-protocol/lib/index.js",function(t,e){var n=e("./keys");t.protocol=2;var r=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},o=n(r),i={type:"error",data:"parser error"};t.encodePacket=function(t){var e=r[t.type];return void 0!==t.data&&(e+=String(t.data)),""+e},t.decodePacket=function(t){var e=t.charAt(0);return Number(e)==e&&o[e]?t.length>1?{type:o[e],data:t.substring(1)}:{type:o[e]}:i},t.encodePayload=function(e){if(!e.length)return"0:";for(var n,r="",o=0,i=e.length;i>o;o++)n=t.encodePacket(e[o]),r+=n.length+":"+n;return r},t.decodePayload=function(e,n){var r;if(""==e)return n(i,0,1);for(var o,s,a="",u=0,c=e.length;c>u;u++){var l=e.charAt(u);if(":"!=l)a+=l;else{if(""==a||a!=(o=Number(a)))return n(i,0,1);if(s=e.substr(u+1,o),a!=s.length)return n(i,0,1);if(s.length){if(r=t.decodePacket(s),i.type==r.type&&i.data==r.data)return n(i,0,1);var f=n(r,u+o,c);if(!1===f)return}u+=o,a=""}}return""!=a?n(i,0,1):void 0}}),t.register("LearnBoost-engine.io-protocol/lib/keys.js",function(t,e,n){n.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}}),t.register("visionmedia-debug/index.js",function(t,e,n){n.exports="undefined"==typeof window?e("./lib/debug"):e("./debug")}),t.register("visionmedia-debug/debug.js",function(t,e,n){function r(t){return r.enabled(t)?function(e){e=o(e);var n=new Date,i=n-(r[t]||n);r[t]=n,e=t+" "+e+" +"+r.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function o(t){return t instanceof Error?t.stack||t.message:t}n.exports=r,r.names=[],r.skips=[],r.enable=function(t){try{localStorage.debug=t}catch(e){}for(var n=(t||"").split(/[\s,]+/),o=n.length,i=0;o>i;i++)t=n[i].replace("*",".*?"),"-"===t[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$"))},r.disable=function(){r.enable("")},r.humanize=function(t){var e=1e3,n=6e4,r=60*n;return t>=r?(t/r).toFixed(1)+"h":t>=n?(t/n).toFixed(1)+"m":t>=e?(0|t/e)+"s":t+"ms"},r.enabled=function(t){for(var e=0,n=r.skips.length;n>e;e++)if(r.skips[e].test(t))return!1;for(var e=0,n=r.names.length;n>e;e++)if(r.names[e].test(t))return!0;return!1},window.localStorage&&r.enable(localStorage.debug)}),t.register("engine.io/lib/index.js",function(t,e,n){n.exports=e("./socket"),n.exports.parser=e("engine.io-parser")}),t.register("engine.io/lib/socket.js",function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);if(e=e||{},"object"==typeof t&&(e=t,t=null),t&&(t=i.parseUri(t),e.host=t.host,e.secure="https"==t.protocol||"wss"==t.protocol,e.port=t.port,t.query&&(e.query=t.query)),this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol,e.host){var n=e.host.split(":");e.hostname=n.shift(),n.length&&(e.port=n.pop())}this.hostname=e.hostname||(f.location?location.hostname:"localhost"),this.port=e.port||(f.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=i.qsParse(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.timestampParam=e.timestampParam||"t",this.timestampRequests=!!e.timestampRequests,this.flashPath=e.flashPath||"",this.transports=e.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=e.policyPort||843,this.open(),r.sockets.push(this),r.sockets.evs.emit("add",this)}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=e("./util"),s=e("./transports"),a=e("./emitter"),u=e("debug")("engine-client:socket"),c=e("indexof"),l=e("engine.io-parser");n.exports=r;var f=i.global();a(r.prototype),r.protocol=l.protocol,r.sockets=[],r.sockets.evs=new a,r.Socket=r,r.Transport=e("./transport"),r.Emitter=e("./emitter"),r.transports=e("./transports"),r.util=e("./util"),r.parser=e("engine.io-parser"),r.prototype.createTransport=function(t){u('creating transport "%s"',t);var e=o(this.query);e.EIO=l.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new s[t]({hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,flashPath:this.flashPath,policyPort:this.policyPort});return n},r.prototype.open=function(){this.readyState="opening";var t=this.createTransport(this.transports[0]);t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){var e=this;this.transport&&(u("clearing existing transport"),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(e){if(!r){r=!0;var i=new Error("probe error: "+e);i.transport=n.name,n.close(),n=null,u('probe transport "%s" failed because of error: %s',t,e),o.emit("error",i)}}u('probing transport "%s"',t);var n=this.createTransport(t,{probe:1}),r=!1,o=this;n.once("open",function(){r||(u('probe transport "%s" opened',t),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(i){if(!r)if("pong"==i.type&&"probe"==i.data)u('probe transport "%s" pong',t),o.upgrading=!0,o.emit("upgrading",n),u('pausing current transport "%s"',o.transport.name),o.transport.pause(function(){r||"closed"!=o.readyState&&"closing"!=o.readyState&&(u("changing transport and sending upgrade packet"),n.removeListener("error",e),o.emit("upgrade",n),o.setTransport(n),n.send([{type:"upgrade"}]),n=null,o.upgrading=!1,o.flush())});else{u('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=n.name,o.emit("error",s)}}))}),n.once("error",e),n.open(),this.once("close",function(){n&&(u("socket closed prematurely - aborting probe"),r=!0,n.close(),n=null)}),this.once("upgrading",function(t){n&&t.name!=n.name&&(u('"%s" works - aborting "%s"',t.name,n.name),n.close(),n=null)})},r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(u('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(i.parseJSON(t.data));break;case"pong":this.setPing();break;case"error":var e=new Error("server error");e.code=t.data,this.emit("error",e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);var n={data:t.data};n.toString=function(){return t.data},this.onmessage&&this.onmessage.call(this,n)}else u('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!=e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){this.sendPacket("ping")},r.prototype.onDrain=function(){this.callbacks(),this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.callbacks=function(){for(var t=0;t<this.prevBufferLen;t++)this.callbackBuffer[t]&&this.callbackBuffer[t]()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e){return this.sendPacket("message",t,e),this},r.prototype.sendPacket=function(t,e,n){var r={type:t,data:e};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),u("socket closing - telling transport to close"),this.transport.close(),this.transport.removeAllListeners()),this},r.prototype.onError=function(t){u("socket error %j",t),this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"==this.readyState||"open"==this.readyState){u('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0);var r=this.readyState;this.readyState="closed","open"==r&&this.emit("close",t,e),this.onclose&&this.onclose.call(this),this.id=null}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;r>n;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}}),t.register("engine.io/lib/transport.js",function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState=""}var o=(e("./util"),e("engine.io-parser")),i=e("./emitter");n.exports=r,i(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!=this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){this.onPacket(o.decodePacket(t))},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),t.register("engine.io/lib/emitter.js",function(t,e,n){var r=e("emitter");n.exports=r,r.prototype.addEventListener=r.prototype.on,r.prototype.removeEventListener=r.prototype.off,r.prototype.removeListener=r.prototype.off}),t.register("engine.io/lib/util.js",function(t,e){var n=!1;t.global=function(){return"undefined"!=typeof window?window:global},t.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},t.keys=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e},t.on=function(t,e,n,r){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,r)},t.load=function(e){var r=t.global();
return r.document&&"complete"===document.readyState||n?e():(t.on(r,"load",e,!1),void 0)},"undefined"!=typeof window&&t.load(function(){n=!0}),t.defer=function(e){return t.ua.webkit&&"undefined"==typeof importScripts?(t.load(function(){setTimeout(e,100)}),void 0):e()};var r=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,u=/\s+$/;t.parseJSON=function(e){var n=t.global();return"string"==typeof e&&e?(e=e.replace(a,"").replace(u,""),n.JSON&&JSON.parse?JSON.parse(e):r.test(e.replace(o,"@").replace(i,"]").replace(s,""))?new Function("return "+e)():void 0):null},t.ua={},t.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){var t;try{t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),t.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),t.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),t.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent),t.ua.ios="undefined"!=typeof navigator&&/^(iPad|iPhone|iPod)$/.test(navigator.platform),t.ua.ios6=t.ua.ios&&/OS 6_/.test(navigator.userAgent),t.request=function(n){try{var r=e("xmlhttprequest").XMLHttpRequest;return new r}catch(o){}if(n&&"undefined"!=typeof XDomainRequest&&!t.ua.hasCORS)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!n||t.ua.hasCORS))return new XMLHttpRequest}catch(o){}if(!n)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(o){}};var c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,l=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.parseUri=function(t){for(var e=c.exec(t||""),n={},r=14;r--;)n[l[r]]=e[r]||"";return n},t.qs=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},t.qsParse=function(t){for(var e={},n=t.split("&"),r=0,o=n.length;o>r;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}}),t.register("engine.io/lib/transports/index.js",function(t,e){function n(t){var e,n=!1,i=!1;if(u.location){var s="https:"==location.protocol,c=location.port;Number(c)!==c&&(c=s?443:80),n=t.hostname!=location.hostname||c!=t.port,i=t.secure!=s}return e=a.request(n),i&&u.XDomainRequest&&e instanceof u.XDomainRequest?new o(t):e&&!t.forceJSONP?new r(t):new o(t)}var r=e("./polling-xhr"),o=e("./polling-jsonp"),i=e("./websocket"),s=e("./flashsocket"),a=e("../util");t.polling=n,t.websocket=i,t.flashsocket=s;var u=a.global()}),t.register("engine.io/lib/transports/polling.js",function(t,e,n){function r(t){o.call(this,t)}var o=e("../transport"),i=e("../util"),s=e("engine.io-parser"),a=e("debug")("engine.io-client:polling");n.exports=r;var u=i.global();i.inherits(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){a("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(a("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){a("pre-pause polling complete"),--r||e()})),this.writable||(a("we are currently writing - waiting to pause"),r++,this.once("drain",function(){a("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;a("polling got data %s",t),s.decodePayload(t,function(t){return"opening"==e.readyState&&e.onOpen(),"close"==t.type?(e.onClose(),!1):(e.onPacket(t),void 0)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():a('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){a("sending close packet"),this.send([{type:"close"}])},r.prototype.write=function(t){var e=this;this.writable=!1,this.doWrite(s.encodePayload(t),function(){e.writable=!0,e.emit("drain")})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return(u.ActiveXObject||i.ua.android||i.ua.ios6||this.timestampRequests)&&(t[this.timestampParam]=+new Date),t=i.qs(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t}}),t.register("engine.io/lib/transports/polling-xhr.js",function(t,e,n){function r(){}function o(t){if(s.call(this,t),l.location){var e="https:"==location.protocol,n=location.port;Number(n)!==n&&(n=e?443:80),this.xd=t.hostname!=l.location.hostname||n!=t.port}}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.async=!1!==t.async,this.data=void 0!=t.data?t.data:null,this.create()}var s=e("./polling"),a=e("../util"),u=e("../emitter"),c=e("debug")("engine.io-client:polling-xhr");n.exports=o,n.exports.Request=i;var l=a.global(),f=l[["Active"].concat("Object").join("X")];a.inherits(o,s),o.prototype.doOpen=function(){var t=this;a.defer(function(){s.prototype.doOpen.call(t)})},o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,new i(t)},o.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},o.prototype.doPoll=function(){c("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},u(i.prototype),i.prototype.create=function(){var t=this.xhr=a.request(this.xd),e=this;if(t.open(this.method,this.uri,this.async),"POST"==this.method)try{t.setRequestHeader?t.setRequestHeader("Content-type","text/plain;charset=UTF-8"):t.contentType="text/plain"}catch(n){}this.xd&&l.XDomainRequest&&t instanceof XDomainRequest?(t.onerror=function(t){e.onError(t)},t.onload=function(){e.onData(t.responseText)},t.onprogress=r):("withCredentials"in t&&(t.withCredentials=!0),t.onreadystatechange=function(){var n;try{if(4!=t.readyState)return;200==t.status||1223==t.status?n=t.responseText:e.onError(t.status)}catch(r){e.onError(r)}void 0!==n&&e.onData(n)}),c("sending xhr with url %s | data %s",this.uri,this.data);try{t.send(this.data)}catch(n){return setTimeout(function(){e.onError(n)},0),void 0}f&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup()},i.prototype.cleanup=function(){if("undefined"!=typeof this.xhr){this.xhr.onreadystatechange=r,this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}f&&delete i.requests[this.index],this.xhr=null}},i.prototype.abort=function(){this.cleanup()},f&&(i.requestsCount=0,i.requests={},l.attachEvent("onunload",function(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}))}),t.register("engine.io/lib/transports/polling-jsonp.js",function(t,e,n){function r(t){o.call(this,t),s||(a.___eio||(a.___eio=[]),s=a.___eio),this.index=s.length;var e=this;s.push(function(t){e.onData(t)}),this.query.j=this.index}var o=e("./polling"),i=e("../util");n.exports=r;var s,a=i.global(),u=/\n/g;i.inherits(r,o),r.prototype.doOpen=function(){var t=this;i.defer(function(){o.prototype.doOpen.call(t)})},r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),o.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),this.script=e,i.ua.gecko&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},r.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(t){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),this.area.value=t.replace(u,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&n()}:this.iframe.onload=n}}),t.register("engine.io/lib/transports/websocket.js",function(t,e,n){function r(t){i.call(this,t)}function o(){return"undefined"==typeof window?e("ws"):u.WebSocket||u.MozWebSocket}var i=e("../transport"),s=e("engine.io-parser"),a=e("../util");e("debug")("engine.io-client:websocket"),n.exports=r;var u=a.global();a.inherits(r,i),r.prototype.name="websocket",r.prototype.doOpen=function(){if(this.check()){var t=this;this.socket=new(o())(this.uri()),this.socket.onopen=function(){t.onOpen()},this.socket.onclose=function(){t.onClose()},this.socket.onmessage=function(e){t.onData(e.data)},this.socket.onerror=function(e){t.onError("websocket error",e)}}},r.prototype.write=function(t){function e(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var r=0,o=t.length;o>r;r++)this.socket.send(s.encodePacket(t[r]));"bufferedAmount"in this.socket?this.bufferedAmountId=setInterval(function(){0==n.socket.bufferedAmount&&(clearInterval(n.bufferedAmountId),e())},50):setTimeout(e,0)},r.prototype.onClose=function(){clearInterval(this.bufferedAmountId),i.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.socket&&this.socket.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=+new Date),t=a.qs(t),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t},r.prototype.check=function(){var t=o();return!(!t||"__initialize"in t&&this.name===r.prototype.name)}}),t.register("engine.io/lib/transports/flashsocket.js",function(t,e,n){function r(t){s.call(this,t),this.flashPath=t.flashPath,this.policyPort=t.policyPort}function o(t,e){if(f[t])return e();var n=document.createElement("script"),r=!1;u('loading "%s"',t),n.onload=n.onreadystatechange=function(){if(!r&&!f[t]){var o=n.readyState;o&&"loaded"!=o&&"complete"!=o||(u('loaded "%s"',t),n.onload=n.onreadystatechange=null,r=!0,f[t]=!0,e())}},n.async=1,n.src=t;var o=document.getElementsByTagName("head")[0];o.insertBefore(n,o.firstChild)}function i(t,e){function n(r){return t[r]?(o(t[r],function(){n(++r)}),void 0):e()}n(0)}var s=e("./websocket"),a=e("../util"),u=e("debug")("engine.io-client:flashsocket");n.exports=r;var c=a.global(),l=c[["Active"].concat("Object").join("X")];a.inherits(r,s),r.prototype.name="flashsocket",r.prototype.doOpen=function(){function t(t){return function(){var e=Array.prototype.join.call(arguments," ");u("[websocketjs %s] %s",t,e)}}if(this.check()){WEB_SOCKET_LOGGER={log:t("debug"),error:t("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var e=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&e.unshift(this.flashPath+"swfobject.js");var n=this;i(e,function(){n.ready(function(){WebSocket.__addTask(function(){s.prototype.doOpen.call(n)})})})}},r.prototype.doClose=function(){if(this.socket){var t=this;WebSocket.__addTask(function(){s.prototype.doClose.call(t)})}},r.prototype.write=function(){var t=this,e=arguments;WebSocket.__addTask(function(){s.prototype.write.apply(t,e)})},r.prototype.ready=function(t){function e(){r.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),r.loaded=!0),t.call(n)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(swfobject.getFlashPlayerVersion().major<10)){var n=this;return document.body?e():(a.load(e),void 0)}},r.prototype.check=function(){if("undefined"==typeof window)return!1;if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(l){var t=null;try{t=new l("ShockwaveFlash.ShockwaveFlash")}catch(e){}if(t)return!0}else for(var n=0,r=navigator.plugins.length;r>n;n++)for(var o=0,i=navigator.plugins[n].length;i>o;o++)if("Shockwave Flash"==navigator.plugins[n][o].description)return!0;return!1};var f={}}),t.alias("component-emitter/index.js","engine.io/deps/emitter/index.js"),t.alias("component-emitter/index.js","emitter/index.js"),t.alias("component-indexof/index.js","engine.io/deps/indexof/index.js"),t.alias("component-indexof/index.js","indexof/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/lib/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/keys.js","engine.io/deps/engine.io-parser/lib/keys.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","LearnBoost-engine.io-protocol/index.js"),t.alias("visionmedia-debug/index.js","engine.io/deps/debug/index.js"),t.alias("visionmedia-debug/debug.js","engine.io/deps/debug/debug.js"),t.alias("visionmedia-debug/index.js","debug/index.js"),t.alias("engine.io/lib/index.js","engine.io/index.js"),"object"==typeof exports)module.exports=t("engine.io");else if("function"==typeof define&&define.amd){var e=function(){return t("engine.io")};define("eio",e)}else this.eio=t("engine.io")}(),define("util/backoff",["eventemitter2","lodash"],function(t,e){function n(e){this._failAfter=e&&e.failAfter||10,this._startDelay=e&&e.startDelay||100,this._maxDelay=e&&e.maxDelay||1e4,this._fibo1=1,this._fibo2=1,this._currentAttempt=1,this._timeOut=null,this._lastDelay=this._startDelay,this._emitter=new t}function r(t){if(!e.contains(o,t))throw new Error("Unknown event type: "+t)}var o=["start","finish","fail"];return n.prototype.on=function(t,e){r(t),this._emitter.on(t,e)},n.prototype.off=function(t,e){r(t),this._emitter.off(t,e)},n.prototype.start=function(){if(this._currentAttempt>=this._failAfter)return this.reset(),this._emitter.emit("fail"),void 0;var t=this._fibonacci(),n=this._currentAttempt;this._currentAttempt++;var r=Math.min(this._startDelay*t,this._maxDelay);this._lastDelay=r,this._emitter.emit("start",n,r,this),this._timeOut=setTimeout(e.bind(function(){this._emitter.emit("finish",n,r,this)},this),r)},n.prototype.reset=function(){this._currentAttempt=1,this._fibo1=1,this._fibo2=1,this._timeOut&&(clearTimeout(this._timeOut),this._timeOut=null)},n.prototype._fibonacci=function(){if(this._currentAttempt<3)return 1;var t=this._fibo1+this._fibo2;return this._fibo1=this._fibo2,this._fibo2=t,t},n}),define("util/logging",["lodash"],function(t){function e(e){this.moduleName=e,t.bind(this.log,this),t.each(i,function(e){var n=r[e];this[e]=t.bind(this.log,this,n)},this)}var n={},r={silly:0,debug:1,verbose:2,info:3,warn:4,error:5},o=t.invert(r),i=t.keys(r);return n.loggers={},n.raw=function(){},n.Logger=e,e.prototype.log=function(e){var r=Array.prototype.slice.call(arguments,1),i=r[r.length-1],s=t.isFunction(i)?r.pop():null;i=r[r.length-1];var a=t.isObject(i)&&!t.isArray(i)?r.pop():{},u=r.shift();n.raw(o[e]+": "+this.moduleName+": "+u,r,a),s&&s()},n.logger=function(t){return n.loggers[t]||(n.loggers[t]=new e(t)),n.loggers[t]},n.get=n.logger,n}),define("global/navigator",["global/window"],function(t){return t.navigator}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/inherits",[],function(){return"function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errorgen",["lodash","common/inherits"],function(_,inherits){function detectStacktrace(){try{throw new Error("probing")}catch(t){var e=t.stack;if(!e)return!1;try{e=e.substring(1)}catch(n){return!1}}return!0}function detectStackHasMessage(){try{throw new Error("probing")}catch(t){var e=t.stack;return/^Error: probing\n/.test(e)?!0:!1}}function detectMutableStacktrace(){function t(t){this.message=t;var e=(new Error).stack;this.stack=e.substring(1)}inherits(t,Error);try{throw new t("probing")}catch(e){return e.stacktrace?!1:e instanceof t&&"probing"===e.message?!0:!1}}function detectNeedToString(){function t(t){this.message=t,this.name="Tmp"}inherits(t,Error);var e;try{throw new Error("probing")}catch(n){e=n.toString().replace(/^Error/,"Tmp")}try{throw new t("probing")}catch(n){try{var r=n.toString();return r!==e}catch(o){return!0}}}function GoInstantError(){throw new Error("GoInstantError is an abstract base-class")}function generateClass(name){var curClass;return eval(TEMPLATE.replace(/X/g,name)+"\ncurClass = "+name+";"),inherits(curClass,GoInstantError),canCaptureStacktrace&&(curClass.prototype.name=name),needsToString&&(curClass.prototype.toString=function(){return this.name+": "+this.message}),inWindow||(curClass.prototype.inspect=function(){return"["+this.toString()+"]"}),curClass}function errorgen(t){_.isString(t)&&(t=[t]);var e={};return _.each(t,function(t){e[t]=generateClass(t)}),e}var inWindow=!1;try{inWindow=!!window}catch(e){}var canCaptureStacktrace=!!Error.captureStackTrace,hasStacktrace=canCaptureStacktrace||detectStacktrace(),stackHasMessage=hasStacktrace&&detectStackHasMessage(),hasMutableStacktrace=canCaptureStacktrace||detectMutableStacktrace(),needsToString=detectNeedToString(),scrubStack=function(){};scrubStack=stackHasMessage?function(t){return t.replace(/\n[^\n]+\n/,"\n")}:function(t){return t.substr(t.indexOf("\n")+1)},inherits(GoInstantError,Error);var TEMPLATE="";return TEMPLATE+="function X(message) {\n",TEMPLATE+="  \n",TEMPLATE+="  this.message = message;\n",canCaptureStacktrace||(TEMPLATE+="  this.name = 'X';\n"),hasStacktrace&&(canCaptureStacktrace?TEMPLATE+="  Error.captureStackTrace(this, this.name);\n":hasMutableStacktrace&&(TEMPLATE+="  var s = '' + new Error().stack;\n",TEMPLATE+="  this.stack = scrubStack(s);\n")),TEMPLATE+="}\n",errorgen.hasStacktrace=hasStacktrace,errorgen.GoInstantError=GoInstantError,errorgen}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errors",["lodash","common/errorgen"],function(t,e){var n={CollisionError:100,RoomSessionStateError:200,RoomSizeError:201,ConnectionError:202,AuthenticationError:203,PermissionError:204,NotMemberError:205,NotConnectedError:206,NoUserError:207,KeyNameError:300,InvalidRequestError:302,ArgumentError:303},r=t.invert(n),o=e(t.keys(n));return t.each(n,function(t,e){o[e].prototype.code=t}),o.GoInstantError=e.GoInstantError,o.build=function(t,e){var n;n="number"==typeof e?e:e&&e.meta?e.meta.code:0;var i=r[n],s=o[i]||Error;return new s(t)},o}),define("platform/socket",["eio","lodash","eventutil","eventemitter2","util/backoff","util/logging","global/navigator","global/window","common/errors"],function(t,e,n,r,o,i,s,a,u){function c(t,n,i,a,c){if(this.connectUrl=t,!e.isString(this.connectUrl))throw new u.ArgumentError("connectUrl must be a string");if(this.account=n,!e.isString(this.account))throw new u.ArgumentError("account must be a string");if(this.app=i,!e.isString(this.app))throw new u.ArgumentError("app must be a string");if(!e.isString(a)&&!e.isPlainObject(a)&&null!==a)throw new u.ArgumentError("user must be a jwt or a default guest object");if(this.token=null,this._guestDefaults=null,e.isPlainObject(a)){try{JSON.stringify(a)}catch(l){throw new u.ArgumentError("user defaults are not serializable")}this._guestDefaults=a}else this.token=a;this._saveSessionId=!0,this.sessionId=null,e.has(c,"sessionId")&&(this._saveSessionId=!1,this.sessionId=c.sessionId),this._saveGuestId=!0,this.guestId=null,e.has(c,"guestId")&&(this._saveGuestId=!1,this.guestId=c.guestId),this._state=d,this.onlyPolling=e.some(p,function(t){return s.userAgent.indexOf(t)>-1}),this._sendAuth=null;var f=e.defaults({},c,h);this._backoff=new o(f),this._cleanupBackoff=function(){},this._cleanupListeners=function(){},this._emitter=new r}var l=0,f=700,p=["iPhone","Android","iPad"],h={startDelay:100,maxDelay:3e3,failAfter:20},d="disconnected",m="connecting",g="handshaking",y="connected",v="reconnecting",b="rehandshaking",_="disconnecting",k={};k[d]=[m],k[m]=[g,_,d],k[g]=[y,m,_],k[y]=[_,v],k[v]=[b,_,d],k[b]=[y,v,_],k[_]=[d];var w=i.get("platform/socket");return c.prototype._transition=function(t){var n=k[this._state],r={prev:this._state,next:t};if(!e.contains(n,t))throw w.error("Invalid socket state transition",r),new Error('Cannot transition socket from "'+this._state+'" '+'to "'+t+'"!');w.debug("Socket state transition",r),this._state=t},c._makeSocket=function(e,n){return t.Socket(e,n)},c.prototype.send=function(t){if(this._state===d)throw new u.ConnectionError("Socket is not connected (send)");var e;try{e=JSON.stringify(t)}catch(n){throw new u.ArgumentError("JSON Stringify Error: "+n.message)}this.eiSocket.send(e)},c.prototype.on=function(t,e){this._emitter.on(t,e)},c.prototype.off=function(t,e){this._emitter.off(t,e)},c.prototype.close=function(){function t(t){r._transition(d),r._emitter.emit("error",t)}function e(){r._transition(d),r._emitter.emit("disconnect")}this._transition(_),this._cleanup();var r=this;n.register(this.eiSocket,"!error",t,this.eiSocket,"!close",e),this.eiSocket.close(),this.eiSocket=null},c.prototype._getSocketOptions=function(){var t={};return t.transports=this.onlyPolling?["polling"]:["polling","websocket"],t.query={acct:this.account,app:this.app},t},c.prototype.connect=function(t){this._transition(m);var r=this._getSocketOptions();if(this._cleanupBackoff=n.register(this._backoff,"fail",e.bind(this._onRetryConnectFail,this),this._backoff,"finish",e.bind(this._retryConnect,this)),n.register(this._emitter,"!connect",e.bind(t,this,null),this._emitter,"!error",e.bind(t,this)),this.token)this.token.length>f?this._sendAuth=JSON.stringify(["AUTH",this.token]):r.query.jwt=this.token;else if(this._guestDefaults)try{this._sendAuth=JSON.stringify(["AUTH","GUEST",this._guestDefaults])}catch(o){return this._socketError("Guest defaults cannot be serialized")}else r.query.guest=1;var i=this._getSessionId();i&&(r.query.gisid=i);var s=this._getGuestId();s&&(r.query.gid=s),r.query.c=l++;try{this.eiSocket=c._makeSocket(this.connectUrl,r)}catch(o){return this._socketError("initiation failed")}this._backoff.reset(),this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(this._handshaking,this))},c.prototype._getSessionId=function(){return this._saveSessionId?a.sessionStorage.getItem("giSessionId"):this.sessionId},c.prototype._setSessionId=function(t){this._saveSessionId&&a.sessionStorage.setItem("giSessionId",t),this.sessionId=t,this.eiSocket.query.gisid=t},c.prototype._getGuestId=function(){return this._saveGuestId?a.localStorage.getItem("giGuestId"):this.guestId},c.prototype._setGuestId=function(t){this._saveGuestId&&a.localStorage.setItem("giGuestId",t),this.guestId=t,this.eiSocket.query.gid=t},c.prototype._onConnectMessage=function(t){var e;try{e=JSON.parse(t)}catch(n){return this._socketError("malformed message")}var r=e[0];if("ERROR"===r){var o=u.build(e[1],0+e[2]);return this._socketError(o)}if("USER"===r){var i=e[1];this._setSessionId(e[2]),e[3]&&this._setGuestId(e[3]),this._connected(i)}},c.prototype._socketError=function(t){var e="Could not connect: ";(this._state===v||this._state===b)&&(e="Could not reconnect: "),this._state===g||this._state===b?this.close():this._transition(d),t instanceof Error?t.message=e+t.message:t=e+t,w.error("Socket error",{err:t}),this._emitter.emit("error",t)},c.prototype._setupHandshake=function(t,r){function o(){i._transition(r),i._backoff.start()}this._transition(t),null!==this._sendAuth&&(w.debug("sending auth token message"),this.eiSocket.send(this._sendAuth));var i=this;this._cleanupListeners=n.register(this.eiSocket,"!close",o,this.eiSocket,"message",e.bind(this._onConnectMessage,this))},c.prototype._handshaking=function(){this._setupHandshake(g,m)},c.prototype._rehandshaking=function(){this._setupHandshake(b,v)},c.prototype._connected=function(t){function r(){o._transition(v),o._backoff.start(),o._emitter.emit("disconnect")}this._transition(y),this._backoff.reset();var o=this;this._cleanupListeners(),this._cleanupListeners=n.register(this.eiSocket,"!close",r,this.eiSocket,"message",e.bind(this._emitter.emit,this._emitter,"message")),this._emitter.emit("connect",t)},c.prototype._cleanup=function(){this._backoff.reset(),this._cleanupBackoff(),this._cleanupListeners()},c.prototype._onRetryConnectFail=function(){this._cleanup(),this._socketError("Maximum number of reconnect attempts reached.")},c.prototype._retryConnect=function(){var t;if(this._state===m)t=this._handshaking;else{if(this._state!==v)return this._socketError("Invalid state seen during retry");t=this._rehandshaking}this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(t,this)),this.eiSocket.open()},c}),define("util/validation",["lodash"],function(t){var e={};return e.optionalCallback=function(e){return t.isUndefined(e)||t.isNull(e)||t.isFunction(e)},e.requiredCallback=function(e){return!(!e||!t.isFunction(e))},e.contained=function(e,n){return t.contains(e,n)},e.subset=function(e,n){var r=t.difference(e,n);return 0===r.length},e.isFunction=function(e){return t.isFunction(e)},e.throwOrCallback=function(e,n){if(!t.isFunction(n))throw e;n(e)},e}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/constants",[],function(){var t={};t.SLASH_SPACE_TRIMMER=/^[\/\s]+|[\/\s]+$/g;var e="a-zA-Z0-9",n=e+".",r=e+".@_:-",o="["+n+"]["+r+"]{0,127}",i="["+e+"]["+r+"]{0,127}";t.NAME_REGEX_BODY=i;var s="[%"+r+"]{1,128}";return t.INTERNAL_NAME_REGEX_BODY=s,t.NAME_REGEX=new RegExp("^"+i+"$"),t.INTERNAL_NAME_REGEX=new RegExp("^"+s+"$"),t.KEY_REGEX="(?:(?:/)?"+o+"(?:/|)?)*",t.NAME_RULES_ENGLISH=" names are case sensitive, must be alphanumeric (1-128 chars), and can include non-leading -, _, ., @, and :",t}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);define("common/key_name",["lodash","common/constants"],function(t,e){var n={},r=e.SLASH_SPACE_TRIMMER;return n.clean=function(e){if("/"===e)return"/";if(!t.isString(e))return null;if(e="/"+e.replace(r,""),1===e.length)return null;var o=n.validate(e);return o?e:null},n.validate=function(n){if(!t.isString(n)||n.length<1||"/"!==n[0])return!1;if("/"===n)return!0;var r=n.split("/");r.shift(),".users"===r[0]&&(r.shift(),r.length>0&&e.INTERNAL_NAME_REGEX.test(r[0])&&r.shift());var o=t.every(r,function(t){return e.NAME_REGEX.test(t)});return o},n}),define("platform/channel",["eventemitter2","lodash","util/validation","common/key_name"],function(t,e,n,r){function Channel(e,n){if(this._room=e,this.name=r.clean(n),null===this.name)throw new Error("Invalid channel name: "+n);this._emitter=new t}return Channel.COMMANDS={message:"MESSAGE"},Channel.VALID_EVENTS=e.keys(Channel.COMMANDS),Channel.prototype.on=function(t,e,n){this._room._on(this.name,Channel.VALID_EVENTS,t,e,n)},Channel.prototype.off=function(t,e,n){var r={local:!1,bubble:!1,listener:e};this._room._off(this.name,Channel.VALID_EVENTS,t,r,n)},Channel.prototype.message=function(t,r){var o;if(e.isUndefined(t)&&(o=new Error("Message cannot be undefined")),n.optionalCallback(r)||(o=new Error("Callback should be a function or undefined")),o)return n.throwOrCallback(o,r);var i={key:this.name,value:t};this._room._request(Channel.COMMANDS.message,i,r)},Channel}),define("platform/watch_registry",["lodash"],function(t){function e(){this._listeners=[]}return e.prototype.add=function(t){var e=this._wrap(t);return this._listeners.push(e),e},e.prototype.remove=function(t){var e=this._indexOf(t),n=null;return e>=0&&(n=this._listeners[e],this._listeners.splice(e,1)),n},e.prototype.clear=function(){var t=this._listeners;return this._listeners=[],t},e.prototype._indexOf=function(e){return t.findIndex(this._listeners,{__wrapped:e})},e.prototype._wrap=function(t){var e=function(){var t=Array.prototype.slice.call(arguments);e.__wrapped.apply(this,t)};return e.__wrapped=t,e},e}),define("platform/key",["lodash","async","util/validation","common/key_name","platform/watch_registry","common/errors"],function(t,e,n,r,o,i){function Key(t,e){this._room=t,this.name=s(e),this._watchRegistry=new o}function s(t){var e=r.clean(t);if(null===e)throw new i.KeyNameError("Invalid key name: "+t);return e}function a(t,e){return n.optionalCallback(e)?void 0:"Key#"+t+" requires the callback to be a function if it is provided"}function u(e,n){return t.isPlainObject(e)?e=t.defaults(e,Key.DEFAULT_COMMAND_OPTIONS):(n=n||e,e=Key.DEFAULT_COMMAND_OPTIONS),{options:e,cb:n}}return Key.COMMANDS={get:"GET",set:"SET",update:"UPDATE",remove:"REMOVE",add:"ADD"},Key.VALID_EVENTS=["update","set","remove","add"],Key.DEFAULT_COMMAND_OPTIONS={bubble:!0,local:!0},Key.DEFAULT_SET_OPTIONS={overwrite:!0},Key.prototype._childName=function(t){return this.name+s(t)},Key.prototype._parentName=function(){var t=this.name.split("/").slice(1,-1);return"/"+t.join("/")},Key.prototype.key=function(t){return new Key(this._room,this._childName(t))},Key.prototype.parent=function(){var t=this._parentName();return this.name==t?this:new Key(this._room,t)},Key.prototype._cascade=function(e){e=t.isArray(e)?e:[e],e=t.map(e,function(t){return t instanceof Key?t.name:new Error("non-key")});var n=t.any(e,function(t){return t instanceof Error});return n?new Error("Non-key passed to cascade"):e},Key.prototype.set=function(e,r,o){var i;(t.isNull(e)||t.isUndefined(e))&&(i=new Error("Key#set cannot be passed null or undefined. Use remove instead."));var s=u(r,o);if(r=s.options,o=s.cb,r=t.defaults(r,Key.DEFAULT_SET_OPTIONS),i)return n.throwOrCallback(i,o);var c=a("set",o);if(c)throw new Error(c);if(r.cascade&&(r.cascade=this._cascade(r.cascade),r.cascade instanceof Error))return n.throwOrCallback(r.cascade,o);var l={key:this.name,value:e,options:r};this._room._request(Key.COMMANDS.set,l,o)},Key.prototype.update=function(e,r,o){var i=u(r,o);if(r=i.options,o=i.cb,!t.isObject(e)){var s=new Error("Key#update should only be used for hash-like object operations.");return n.throwOrCallback(s,o)}var c=a("update",o);if(c)throw new Error(c);if(r.cascade&&(r.cascade=this._cascade(r.cascade),r.cascade instanceof Error))return n.throwOrCallback(r.cascade,o);var l={key:this.name,value:e,options:r};this._room._request(Key.COMMANDS.update,l,o)},Key.prototype.add=function(e,r,o){var i=u(r,o);if(r=i.options,o=i.cb,t.isNull(e)||t.isUndefined(e)){var s=new Error("Key#add cannot be passed null or undefined.");
return n.throwOrCallback(s,o)}var c=a("add",o);if(c)throw new Error(c);if(r.cascade&&(r.cascade=this._cascade(r.cascade),r.cascade instanceof Error))return n.throwOrCallback(r.cascade,o);var l={key:this.name,value:e,options:r};this._room._request(Key.COMMANDS.add,l,o)},Key.prototype.get=function(e){if(!e||!t.isFunction(e))throw new Error("Key#get requires a callback");var n={key:this.name};this._room._request(Key.COMMANDS.get,n,e)},Key.prototype.remove=function(t,e){var n=u(t,e);t=n.options,e=n.cb;var r=a("remove",e);if(r)throw new Error(r);var o={key:this.name,options:t};this._room._request(Key.COMMANDS.remove,o,e)},Key.prototype.on=function(t,e,n){this._room._on(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.off=function(t,e,n){this._room._off(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.watch=function(e,r){var o;if(t.isFunction(e)?n.optionalCallback(r)||(o=new Error("Key#watch optional callback must be a function")):o=new Error("Key#watch listener must be a function"),o)return n.throwOrCallback(o,r);var i=this._watchRegistry.add(e),s={local:!0,bubble:!0,listener:i},a=this;a.get(function(e){if(!e){var n=Array.prototype.slice.call(arguments,1);i.apply(this,n),t.each(Key.VALID_EVENTS,function(t){a.on(t,s)})}r&&r(e)})},Key.prototype.unwatch=function(e,r){var o;if(n.optionalCallback(e)?n.optionalCallback(r)||(o=new Error("Key#unwatch optional callback must be a function")):o=new Error("Key#unwatch optional listener must be a function"),o)return n.throwOrCallback(o,r);var i;if(t.isFunction(e)){var s=this._watchRegistry.remove(e);if(!s)return o=new Error("Key#unwatch listener is not a watch function"),n.throwOrCallback(o,r);i=[s]}else i=this._watchRegistry.clear();var a=this;t.each(i,function(e){t.each(Key.VALID_EVENTS,function(t){a.off(t,e)})}),r&&r()},Key}),define("platform/room",["lodash","async","platform/channel","platform/key","common/constants","common/errors","util/validation"],function(t,e,Channel,Key,n,r,o){function Room(e,r){if(!n.NAME_REGEX.test(r))throw new Error(c+" Invalid room: "+r);this.name=r,this._connection=e;var o=this,i=this.key(".users");this._buildFns(),t.each(t.methods(i),function(e){o.users[e]=t.bind(i[e],i)})}var i=r.NotMemberError,s=r.NotConnectedError,a=o.throwOrCallback,u="You must connect to GoInstant before you can perform operations on a key or room",c="Room"+n.NAME_RULES_ENGLISH;Room.VALID_EVENTS=["join","leave"],Room.COMMANDS={join:"JOIN",leave:"LEAVE",users:"USERS"};var l={local:!1,bubble:!1},f={local:!0,bubble:!1},p=[!0,!1],h=["local","bubble","listener"];return Room.prototype._buildFns=function(){var e=this;this.users=function(n){if(!t.isFunction(n))throw new Error("You must pass a callback function to room#users");if(!e._connection._socket)return a(new s(u),n);var r={key:"/.users"};e._request(Room.COMMANDS.users,r,function(r,o){if(r)return n(r);var i=o,s={};t.each(i,function(t,n){s[n]=e.key("/.users/"+n)}),n(null,i,s)})}},Room.prototype.join=function(n,r){function o(t){i.user(function(e,n){return e?t(e):(t(null,i,n),void 0)})}var i=this;if(!t.isFunction(r)&&!t.isFunction(n))throw new Error("A callback must be provided");if(t.isFunction(n))r=n,n=null;else if(!t.isPlainObject(n))throw new Error("userObject must be an object");var s={key:"/.users",options:f};this._request(Room.COMMANDS.join,s,function(s){if(s)return r(s);if(i._connection._joined(i),n){var a=i.key("/.users/"+i._connection._user.id);e.each(t.keys(n),function(t,e){a.key(t).set(n[t],e)},function(t){t?i.leave(function(){return r(t)}):o(r)})}else o(r)})},Room.prototype.leave=function(e){var n=this;if(e||(e=function(){}),e&&!t.isFunction(e))throw new Error("You must provide a callback");if(!this._connection._socket)return a(new s(u),e);var r={key:"/.users",options:f};this._request(Room.COMMANDS.leave,r,function(r,o,i){if(r)return e(r);n._connection._left(n);var s=t.cloneDeep(i||{});s.context=t.cloneDeep(i||{}),s.options={bubble:!1,local:!0},s.local=!0,n._connection._registry.emit(s),n._off(),e()})},Room.prototype.user=function(e){if(t.isFunction(e))return this._oldUser(e);if(!t.isString(e))throw new r.ArgumentError("You must pass a string for a userId");return this.key("/.users/"+e)},Room.prototype._oldUser=function(e){if(!t.isFunction(e))throw new Error("You must pass a callback function to room#user");if(!this._connection._socket)return a(new s(u),e);var n=this._connection._user,r=this.key("/.users/"+n.id);r.get(function(t,n){return t?e(t):(e(null,n,r),void 0)})},Room.prototype.self=function(){if(!this._connection._socket||!this._connection._user)throw new s(u);return this.key("/.users/"+this._connection._user.id)},Room.prototype.on=function(t,e,n){this._on("/.users",Room.VALID_EVENTS,t,e,n)},Room.prototype.off=function(e,n,r){var o,i={};t.isFunction(n)?(o=n,n=null):n&&t.isFunction(n.listener)&&(o=n.listener,i.local=n.local),t.defaults(i,l),this._off("/.users",Room.VALID_EVENTS,e,i,r)},Room.prototype.key=function(t){return new Key(this,t)},Room.prototype.channel=function(t){return new Channel(this,t)},Room.prototype._request=function(e,n,r){if(!this._connection._socket)return a(new s(u),r);var o=["JOIN","LEAVE"],c=t.pluck(this._connection._joinedRooms,"name");if(!t.contains(o,e)&&!t.contains(c,this.name)){var l='You must join the room "'+this.name+'" '+"before you can perform any operations on this key";return a(new i(l),r)}n.room=this.name,this._connection._request(e,n,r)},Room.prototype._on=function(e,n,r,i,s){t.isUndefined(s)&&(s=null);var a,u={};t.isFunction(i)?(a=i,i=null):i&&t.isFunction(i.listener)&&(a=i.listener,u.local=i.local,u.bubble=i.bubble),t.defaults(u,l);var c;return t.isString(r)?t.isString(e)?o.isFunction(a)?o.optionalCallback(s)?o.contained(n,r)?i&&!o.subset(t.keys(i),h)?c="on: options can only contain keys: "+h.join(",")+" but was passed keys: "+t.keys(i):o.subset(t.values(u),p)||(c="on: options.local and options.bubble must be booleans."):c='on: event passed: "'+r+'"'+" is not one of "+n.join(", "):c="on: callback should be a function or undefined":c="on: listener must be a function":c="on: key name passed must be a string":c="on: command passed must be a string",c?o.throwOrCallback(new Error(c),s):(r=r.toUpperCase(),this._connection._on(this.name,e,r,u,a,s),void 0)},Room.prototype._off=function(e,n,r,i,s){t.isUndefined(s)&&(s=null),t.isUndefined(r)&&(r=null),t.isUndefined(i)&&(i=null);var u=null,c=null;t.isFunction(i)?(u=i,i=null):t.isObject(i)&&(u=i.listener,("local"in i||"bubble"in i)&&(c={},"local"in i&&(c.local=i.local),"bubble"in i&&(c.bubble=i.bubble)));var l,f=o.subset(t.values(c),p),d=o.contained(n,r);return r&&!t.isString(r)?l="off: optional command must be a string":o.optionalCallback(u)?!r&&u?l="off: requires command if listener is passed":r&&!d?l='off: command passed: "'+r+'" is not one of '+n.join(", "):o.optionalCallback(s)?i&&!o.subset(t.keys(i),h)?l="off: options can only contain keys: "+h.join(", ")+"but was passed keys: "+t.keys(i):c&&!f&&(l="off: options.local and options.bubble must be booleans."):l="off: optional callback must be a function":l="off: optional listener must be a function",l?a(new Error(l),s):(r&&(r=r.toUpperCase()),this._connection._off(this.name,e,r,i,u,s),void 0)},Room}),define("platform/registry",["eventemitter2","lodash"],function(t,e){function n(){this._rooms={}}function r(t,e,n){return t.length>n.length&&t.substring(0,n.length)==n}function o(t,e,n){if(t&&e){n.removeListener(t,e);var r=0===n.listeners(t).length;return r}return t?n.removeAllListeners(t):n.removeAllListeners(),!0}function i(t){return e.all(t._events,function(t){return!t||e.isArray(t)&&0===t.length})}var s=["JOIN","LEAVE"],a=["command","key","addedKey","value","room","userId","local","overwritten","expired","expire","cascaded","cascade"];return n.prototype.on=function(t,e){var n=t.room,r=t.key,o=t.opts,i=this._findEmitter(n,r,o),s=t.command;i.on(s,e)},n.prototype.off=function(t,e){var n=t.room,r=t.key,o=!1;return o=r?this._offKey(t,e):this._offRoom(n),this._deleteEmptyEmitter(n,r),o},n.prototype.emit=function(t){var n=this._findSubscribingEmitters(t);return e.contains(s,t.command)?(e.each(n,function(e){e.emit(t.command,t.value)}),void 0):(e.each(n,function(n){var r=e.pick(t,a);r.currentKey=n.name,r.bubble=r.currentKey!==t.key,n.emit(r.command,r.value,r)}),void 0)},n.prototype._findEmitters=function(t,e){this._rooms[t]||(this._rooms[t]={});var n=this._rooms[t],r=n[e];return r?[r.bubble.local,r.bubble.remote,r.noBubble.local,r.noBubble.remote]:[]},n.prototype._findEmitter=function(n,r,o){this._rooms[n]||(this._rooms[n]={});var i=this._rooms[n];i[r]||(i[r]={name:r,bubble:{local:new t,remote:new t},noBubble:{local:new t,remote:new t}},e.each(this._findEmitters(n,r),function(t){t.name=r}));var s=i[r];return o.local&&o.bubble?s.bubble.local:o.bubble?s.bubble.remote:o.local?s.noBubble.local:s.noBubble.remote},n.prototype._findSubscribingEmitters=function(t){var e=t.room,n=t.key;this._rooms[e]||(this._rooms[e]={});var r=this._rooms[e],o=[];if(t.options.bubble){var i=this._findBubblingEmitters(t);o=o.concat(i)}var s=r[n];return s?(t.local?(o.unshift(s.noBubble.local),o.unshift(s.bubble.local)):(o.unshift(s.noBubble.remote),o.unshift(s.noBubble.local),o.unshift(s.bubble.remote),o.unshift(s.bubble.local)),o):o},n.prototype._findBubblingEmitters=function(t){var n=t.room,o=t.key,i=this._rooms[n],s=e.filter(i,e.partial(r,o));s=s.sort(function(t,e){return t.name.length<e.name.length});var a=[];return e.each(s,function(e){t.local?a.push(e.bubble.local):(a.push(e.bubble.remote),a.push(e.bubble.local))}),a},n.prototype._offRoom=function(t){var n=this._rooms[t];return e.each(n,function(t){e.each([t.bubble.local,t.bubble.remote,t.noBubble.local,t.noBubble.remote],e.partial(o,null,null))}),delete this._rooms[t],!0},n.prototype._offKey=function(t,n){var r=t.room,i=t.command,s=t.key,a=t.opts;if(a){var u=this._findEmitter(r,s,a);return o(i,n,u)}var c=this._findEmitters(r,s),l=e.map(c,e.partial(o,i,n));return e.all(l)},n.prototype._deleteEmptyEmitter=function(t,n){if(n){var r=this._findEmitters(t,n);if(r){var o=e.all(r,i);if(o){var s=this._rooms[t];delete s[n],0===e.size(this._rooms)&&delete this._rooms[t]}}}},n}),define("util/timeouts",["eventemitter2","lodash","global/window"],function(t,e,n){function r(n){this._emitter=new t,this._timeout=n,this._timer=null,this._timeouts=[],e.bindAll(this,"_handleExpiry")}return r.prototype.add=function(t){this._timeouts.push({item:t,when:+new Date+this._timeout}),1===this._timeouts.length&&this._start()},r.prototype.clear=function(t){var n=e.findIndex(this._timeouts,{item:t}),r=this._timeouts.splice(n,1);this._timeouts.length<=0?this._stop():0===n&&this._timeouts[0].when!==r.when&&(this._stop(),this._start())},r.prototype.on=function(t,e){this._emitter.on(t,e)},r.prototype.off=function(t,e){this._emitter.off(t,e)},r.prototype._start=function(){var t=+new Date,e=this._timeouts[0].when-t;this._timer=n.setTimeout(this._handleExpiry,e)},r.prototype._stop=function(){n.clearTimeout(this._timer),this._timer=null},r.prototype._handleExpiry=function(){for(var t=this._timeouts[0].when;this._timeouts.length>0&&this._timeouts[0].when===t;){var e=this._timeouts.shift();this._emitter.emit("expiry",e.item)}this._timeouts.length>0&&this._start()},r}),define("platform/room_collection",["lodash","common/errors"],function(t,e){function n(t){this._connection=t}var r=e.NotConnectedError,o="You must connect to Platform before you can perform operations on rooms";return n.prototype.get=function(e){if(!this._connection._socket)return e(new r(o));if(!t.isFunction(e))throw new Error("A callback must be provided");var n=this;this._connection._request("ROOMS",{},function(r,o){if(r)return e(r);var i=[];t.each(o,function(t){i.push(n._connection.room(t))}),e(null,i)})},n}),define("connection",["eventemitter2","eventutil","global/json","lodash","async","sharedConfig","util/guard","platform/socket","platform/room","platform/registry","util/validation","util/timeouts","platform/room_collection","common/errors"],function(t,e,n,r,o,i,s,a,Room,u,c,l,f,p){function Connection(e,n){r.bindAll(this,"_onTimeout"),this._validateUrl(e),this._validateOpts(n),this._opts=n,this.sessionid=null,this._socket=null,this._socketCleanup=function(){},this._user=null,this._joinedRooms=[],this.rooms=new f(this),this._registry=new u,this._emitter=new t,this._requestCallbackEmitter=new t,this._currentCallbackId=0,this._timeouts=new l(w),this._timeouts.on("expiry",this._onTimeout),s.all(this,E)}var h="[\\d\\w][\\d\\w\\-]*",d="\\/(.+?)",m="(?:"+h+"\\.)*",g="(?:goinstant\\.(?:com|org|net))",y="(?::\\d{1,5})?",v="(?:$|\\/)",b="^((https?)://(?:"+m+g+"|"+"127\\.0\\.0\\.1"+"|"+"localhost(?:\\.localdomain)?"+")"+"("+y+")"+")",_=new RegExp(b+v),k=new RegExp(b+d+d+v),w=5e3,E=["_onMessage","_onError","_onConnect","_onDisconnect"];Connection.REQUEST_EXPIRY_TIME=w,Connection.prototype._validateUrl=function(t){var e,n,r=!!t&&t.match(i.serverUrl)&&_.test(t);if(r&&(n=t.match(k),r=!!n),!r)throw e='Cannot connect to "'+t+'". The url must be a '+'registered application URL (e.g. "'+i.serverUrl+'/MYACCOUNT/MYAPP").',new p.ArgumentError(e);var o=n[1],s=n[2],a=n[3];if(this._account=n[4],this._application=n[5],i.httpsOnly&&(r="https"===s&&(!a||":443"===a)),!r)throw e='Cannot connect to "'+t+'". '+"The url must be an HTTPS url on the standard port (443).",new p.ArgumentError(e);/:\d+$/.test(o)||(o+=":443"),this._connectUrl=o},Connection.prototype._validateOpts=function(t){if(t){if(!r.isObject(t))throw new Error("opts, if provided, must be an object");var e=r.difference(r.keys(t),["sessionId","guestId"]);if(e.length>0)throw new Error("unknown option(s): "+e.join(", "));if(r.has(t,"sessionId")&&!r.isString(t.sessionId)&&t.sessionId)throw new Error("opts.sessionId must be a string or falsey value");if(r.has(t,"guestId")&&!r.isString(t.guestId)&&t.guestId)throw new Error("opts.guestId must be a string or falsey value")}},Connection.prototype._createCallbackId=function(){return this._currentCallbackId++},Connection.prototype._request=function(t,e,n){n=n||function(){};var o=this._createCallbackId();this._requestCallbackEmitter.once(o,n),this._timeouts.add(o);var i={command:t,room:e.room,key:e.key,value:e.value,options:e.options||{},callbackId:o};r.isUndefined(e.addId)||(i.addId=e.addId);try{this._socket.send(i)}catch(s){this._timeouts.clear(o),this._requestCallbackEmitter.emit(o,s)}},Connection.prototype._onResponse=function(t,e){var n=e.callbackId,r=null;if(t&&(r=p.build(t,e)),"OFF"===e.command||"ON"===e.command)return this._requestCallbackEmitter.emit(n,r);var o=e.value;delete e.callbackId,delete e.meta,this._timeouts.clear(n),this._requestCallbackEmitter.emit(n,r,o,e)},Connection.prototype._onNotify=function(t){this._registry.emit(t)},Connection.prototype.connect=function(t,n){var o=this;1===arguments.length&&(n=t,t=null),n=s.one(n,o);var i=new a(o._connectUrl,o._account,o._application,t,this._opts);i.connect(function(t,s){return t?n(t):(o._user=s,o._socket=i,o._socketCleanup=e.register(i,"message",r.bind(o._onMessage,o),i,"error",r.bind(o._onError,o),i,"disconnect",r.bind(o._onDisconnect,o),i,"connect",r.bind(o._onConnect,o)),o._onConnect(),n(null,o),void 0)})},Connection.prototype.disconnect=function(t){var n=this;return t=t||function(){},n._socket?(n._leaveAllRooms(function(r){function o(){t(r,n),n._onDisconnect()}function i(){t(new Error("Error during disconnect"),n)}n._socketCleanup(),e.register(n._socket,"!disconnect",o,n._socket,"!error",i),n._socket.close(),n._socket=null}),void 0):t(null,n)},Connection.prototype._leaveAllRooms=function(t){var e=[],n=r.map(this._joinedRooms,function(t){return function(n){t.leave(function(r){r&&"User not in room"!==r.message&&e.push({name:t.name,err:r}),n()})}});o.parallel(n,function(){return e.length>0?t(new p.RoomSessionStateError("Failed to leave room(s).")):(t(),void 0)})},Connection.prototype.room=function(t){return new Room(this,t)},Connection.prototype._joined=function(t){var e=r.any(this._joinedRooms,function(e){return t.name===e.name});e||this._joinedRooms.push(t)},Connection.prototype._left=function(t){this._joinedRooms=r.without(this._joinedRooms,t)};var S=["connect","disconnect","error"];return Connection.prototype.on=function(t,e){if(!c.contained(S,t))throw new Error("Invalid event provided:"+t);this._emitter.on(t,e)},Connection.prototype.off=function(t,e){if(!c.contained(S,t))throw new Error("Invalid event provided:"+t);this._emitter.off(t,e)},Connection.prototype._on=function(t,e,n,o,i,s){this._registry.on({room:t,key:e,command:n,opts:o},i),s&&r.defer(s)},Connection.prototype._off=function(t,e,n,o,i,s){this._registry.off({room:t,key:e,command:n,opts:o},i),s&&r.defer(s)},Connection.prototype._rejoinRooms=function(t){var e=this;o.each(this._joinedRooms,function(t,e){t.join(e)},function(n){return n?e.disconnect(r.bind(t,null,n)):t()})},Connection.prototype._onConnect=function(){this.sessionId=this._socket.sessionId,this.guestId=this._socket.guestId;var t=this;this._rejoinRooms(function(e){return e?t._emitter.emit("error",e):(t._emitter.emit("connect"),void 0)})},Connection.prototype._onDisconnect=function(){this._emitter.emit("disconnect")},Connection.prototype._onError=function(t,e){var n=p.build(t,0+e);if(0===this._emitter.listeners("error").length)throw n;this._emitter.emit("error",n)},Connection.prototype._onMessage=function(t){var e=n.parse(t),r=e.shift();switch(r){case"RESPONSE":this._onResponse.apply(this,e);break;case"NOTIFY":this._onNotify.apply(this,e);break;case"ERROR":this._onError(e[1],e[2]);break;case"USER":break;default:this._onError('Unknown message type "'+r+'": '+t)}},Connection.prototype._onTimeout=function(t){var e=new Error("Request timed out");this._requestCallbackEmitter.emit(t,e)},Connection}),define("connect",["lodash","async","connection","util/validation","common/errors"],function(t,e,Connection,n,r){var o={};o._Connection=Connection;var i=["room","rooms","user","sessionId","guestId"];return o.start=function(s,a,u){function c(e){var n=a.user?a.user:null,r=t.pick(a,["sessionId","guestId"]);try{f=new o._Connection(s,r),f.connect(n,e)}catch(i){e(i)}}function l(t,e){try{var n=f.room(t);n.join(e)}catch(r){e(r)}}var f;if(2===arguments.length&&(u=a,a={}),!n.optionalCallback(u))throw r.build("cb must be provided",303);if(!t.isPlainObject(a))return u(r.build("opts if provided must be an object",303));if(t.has(a,"user")&&!t.isString(a.user)&&!t.isPlainObject(a.user))return u(r.build("opts.user if provided must be a jwt string or object",303));if(t.has(a,"room")&&t.has(a,"rooms"))return u(r.build("opts can specify room or rooms, not both",303));if(!(!t.has(a,"room")||t.isString(a.room)||t.isArray(a.room)&&t.all(a.room,t.isString)))return u(r.build("room must be a string or an array of strings",303));if(!(!t.has(a,"rooms")||t.isString(a.rooms)||t.isArray(a.rooms)&&t.all(a.rooms,t.isString)))return u(r.build("rooms must be a string or an array of strings",303));var p=t.keys(a),h=t.difference(p,i);if(h.length)return u(r.build("invalid option(s) provided: "+h.join(", "),303));var d;return d=a.room?a.room:a.rooms?a.rooms:["lobby"],t.isString(d)&&(d=[d]),d.length?(e.series({connection:c,rooms:e.apply(e.map,d,l)},function(t,e){if(t)return f?f.disconnect(function(){return u(t)}):u(t);var n=e.rooms;n.unshift(f),n.unshift(null),u.apply(u,n)}),void 0):u(r.build("room(s) can not be an empty array",303))},o}),define("prod/main",["hide_lodash","iefix","global/window","connection","connect","common/errors","platform/room","platform/key","platform/channel","sharedConfig"],function(t,e,n,Connection,r,o,Room,Key,Channel,i){n.goinstant=n.goinstant||{},n.goinstant.Connection=Connection,n.goinstant.Platform=n.goinstant.Connection,n.goinstant.connect=r.start,n.goinstant.errors=o,n.goinstant.Room=Room,n.goinstant.Key=Key,n.goinstant.Channel=Channel,n.goinstant.sharedConfig=i}),require("prod/main")}();